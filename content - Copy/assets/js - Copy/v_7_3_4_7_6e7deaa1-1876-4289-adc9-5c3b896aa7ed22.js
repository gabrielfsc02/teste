import{S as Q,C as ue,U as te,W as N,G as ce,R as B,a as f,r as k,_ as se,j as g,I as O,E as $,O as jt,b as Wt,c as Vt,P as M,N as Pe,w as Bt}from"./v_7_3_4_7_6e7deaa1-1876-4289-adc9-5c3b896aa7ed10.js";import{a as Me,A as $t}from"./v_7_3_4_7_6e7deaa1-1876-4289-adc9-5c3b896aa7ed6.js";import{c as S,u as F,a as be}from"./v_7_3_4_7_6e7deaa1-1876-4289-adc9-5c3b896aa7ed19.js";import{a as x}from"./v_7_3_4_7_6e7deaa1-1876-4289-adc9-5c3b896aa7ed4.js";import{X as Mt,G as U}from"./v_7_3_4_7_6e7deaa1-1876-4289-adc9-5c3b896aa7ed8.js";import{c as A}from"./v_7_3_4_7_6e7deaa1-1876-4289-adc9-5c3b896aa7ed7.js";import{W as p,V as ze}from"./v_7_3_4_7_6e7deaa1-1876-4289-adc9-5c3b896aa7ed18.js";import{G as Gt}from"./v_7_3_4_7_6e7deaa1-1876-4289-adc9-5c3b896aa7ed2.js";import{O as Ht}from"./v_7_3_4_7_6e7deaa1-1876-4289-adc9-5c3b896aa7ed3.js";import{g as Jt,r as Kt}from"./v_7_3_4_7_6e7deaa1-1876-4289-adc9-5c3b896aa7ed.js";import{d as Tt,l as Qt,u as Xt,b as Yt,f as Zt,s as ea,c as ta,o as aa}from"./v_7_3_4_7_6e7deaa1-1876-4289-adc9-5c3b896aa7ed9.js";const Te={date:{tag:"date",quant:0,max:0,old:Date.now()},init_conversa:{tag:"init_conversa",quant:0,max:5},create_link:{tag:"create_link",quant:0,max:3},close_service:{tag:"close_service",quant:0,max:3},lembretes:{tag:"lembretes",quant:0,max:1},assinatura:{tag:"assinatura",quant:0,max:5},googleCalendario:{tag:"googleCalendario",quant:0,max:1},contatos:{tag:"contatos",quant:0,max:1},respostasRapidas:{tag:"respostasRapidas",quant:0,max:3},agendamentos:{tag:"agendamentos",quant:0,max:1},perfilDoContato:{tag:"perfilDoContato",quant:0,max:10},encomendas:{tag:"encomendas",quant:0,max:1},autoatendimento:{tag:"autoatendimento",quant:0,max:3},fluxo:{tag:"fluxo",quant:0,max:5},followUp:{tag:"followUp",quant:0,max:3},webhook:{tag:"webhook",quant:0,max:3},clear_message:{tag:"clear_message",quant:0,max:1},useTradutor:{tag:"useTradutor",quant:0,max:1},status:{tag:"status",quant:0,max:1},assistente_chat:{tag:"assistente_chat",quant:0,max:3},API:{tag:"API",quant:0,max:3},trascrever_audio:{tag:"trascrever_audio",quant:0,max:1}},xe=A()(a=>({userFreeLimity:Te,setUserFreeLimity:e=>{Q("wpp-functions","functions",[ue.encryptData(e)]),a(t=>({...t,userFreeLimity:e}))},setUserFreeLimityPluginPage:()=>a(e=>({...e,plugin_page:!0}))})),kt=a=>{var s;if(w.getState().user.estado)return!1;const e=xe.getState().userFreeLimity;if(te.subtrData(e.date.old)>1){const o={...Te};for(const i in o)if(Object.prototype.hasOwnProperty.call(o,i)){const r=o[i];r.quant=0,r.tag==="date"&&(r.old=Date.now()),r.tag===a&&(r.quant=1)}return xe.getState().setUserFreeLimity(o),!1}if(e[a]||(e[a]=Te[a]),e[a].quant===((s=e[a])==null?void 0:s.max))return!0;const t={...e};return t[a].quant++,xe.getState().setUserFreeLimity(e),!1},oe=async(a,e=!1)=>{let t=!1;return S.getState().plugin_page?w.getState().user.estado?t=!1:t=await N("exe-CheckUserFreeLock",a):t=kt(a),t&&!e&&X.getState().openRendertype("user_free"),t},pi=async()=>{let a=Te;const e=await ce("wpp-functions","functions");e[0]&&e[0][0]&&(a=ue.decryptData(e[0][0])),xe.getState().setUserFreeLimity(a)};chrome.runtime.onMessage.addListener(async a=>{a.action==="exe-CheckUserFreeLock"&&!S.getState().plugin_page&&chrome.runtime.sendMessage({action:a.action,response:JSON.stringify(kt(a.dados)),id:a.id})});window.addEventListener("message",a=>{if(a.data.type==="Ev"&&a.data.action==="chat.active_chat"){const e=JSON.parse(a.data.model);e&&(e.id={server:"@"+e.id.split("@")[1],user:e.id.split("@")[0],_serialized:e.id},T.setState({activeChat:e}))}});const T=A()(a=>({activeChat:null}));chrome.runtime.onMessage.addListener(a=>{switch(a.action){case"updateActivePerfil":const{activePerfil:e,perfil:t}=P.getState(),{updatePerfil:s}=a.dados,o=t.filter(r=>r.userID!==s.userID),i=[s,...o];e.userID===s.userID?P.setState({activePerfil:s,perfil:i}):P.setState({perfil:i});break;case"BackupPerfil":(async()=>{const r=await B("perfil");P.setState({perfil:r})})();break}});const ft={cargo:"",cidade:"",estado:"",dataNascimento:"",email:"",empresa:"",entrada:"",observacoes:"",origemLead:"",produtos:[],saida:"",sexo:"",valNegocio:[],idioma:"",userID:""};let Le=null;const P=A()((a,e)=>({perfil:[],activePerfil:ft,activeUser:{picture:"",labels:[]},setActiveUser:async({id:t,labels:s})=>{const o=await p.Contact("getProfilePictureUrl",t.user),r=(await p.Labels("getAllLabels")).filter(n=>s.includes(n.id));a({activeUser:{picture:o,labels:r}})},setActivePerfil:t=>a(s=>{const o=s.perfil.find(i=>i.userID===t);return o?{activePerfil:o}:{activePerfil:{...ft,userID:t}}}),updateActivePerfil:(t,s)=>{const{activePerfil:o}=P.getState(),i={...o,[t]:s};a({activePerfil:i}),Le&&clearTimeout(Le),Le=setTimeout(async()=>{if(await oe("perfilDoContato")===!0)return;const{perfil:r}=P.getState(),n={...o,[t]:s},c=r.filter(l=>l.userID!==o.userID),d=[n,...c];f("perfil",d),S.getState().plugin_page?N("updateActivePerfil",{updatePerfil:n},!1):chrome.runtime.sendMessage({action:"updateActivePerfil",dados:{updatePerfil:n}}),a({perfil:d})},1e3)},getValorNegocio:()=>{const{activePerfil:t}=P.getState(),{idioma:s}=F();let o=0;if(t.valNegocio)for(let c of t.valNegocio)o+=parseFloat(c.valor);const i={pt:{locale:"pt-BR",currency:"BRL"},en:{locale:"en-US",currency:"USD"},es:{locale:"es-ES",currency:"EUR"}},{locale:r,currency:n}=i[s]||i.pt;return o.toLocaleString(r,{style:"currency",currency:n})},getPerfilContato:t=>{const{perfil:s}=e();t=t.replace("@g.us","").replace("@c.us","");const o=s.find(r=>r.userID===t);if(!o)return null;let i=0;if(o.valNegocio)for(let r of o.valNegocio)i+=parseFloat(r.valor);return{...o,valorNegocioTotal:i.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}}}));T.subscribe(a=>{a.activeChat&&a.activeChat.id.user&&(P.getState().setActiveUser(a.activeChat),P.getState().setActivePerfil(a.activeChat.id.user))});const sa=async a=>{P.setState({perfil:a}),await f("perfil",a),chrome.runtime.sendMessage({action:"BackupPerfil"})},mi=a=>{const e=[...P.getState().perfil],s=((o,i)=>o.concat(i).reduce((c,d)=>(c.find(u=>u.userID===d.userID)||c.push(d),c),[]))(e,a);sa(s)};(async()=>{const a=await B("perfil");P.setState({perfil:a})})();chrome.runtime.onMessage.addListener(a=>{switch(a.action){case"serviceCompleted":z.getState().dispartWebhook(a.dados,"serviceCompleted");break;case"dispartWebhook":const e=a.dados;z.getState().dispartWebhook(e.userID,e.webhookID,e.eventDetails,e.sendID);break}});const _t=[{id:"eventDetails",active:!0,disabled:!0},{id:"number",active:!0,disabled:!0},{id:"name",active:!0,disabled:!0},{id:"picture",active:!1},{id:"labels",active:!1},{id:"perfilContato",active:!1}],De={id:"metaAds",active:!1,url:"",param:_t,sent:[]},fi=["metaAds","serviceCompleted","respostaRapida","autoAtendimento","followUp","agendamento","crm","labels","messages"],z=A()(a=>({webhook:[],activeHook:De,timeout:null,setActiveHook:e=>a(t=>{const s=t.webhook.find(o=>o.id===e);return s?{activeHook:s}:{activeHook:{id:e,active:!1,url:"",param:_t,sent:[]}}}),setDadosWebHook:(e,t,s)=>a(o=>{let i=null,r=[];return o.webhook.find(c=>c.id===e)?r=o.webhook.map(c=>c.id===e?(i={...c,[t]:s},i):c):(i={...o.activeHook,[t]:s},r=[i,...o.webhook]),f("webhook",r),{activeHook:i,webhook:r}}),setDadosParam:(e,t)=>a(s=>{const o=s.activeHook.param.map(c=>c.id===t?{id:c.id,active:!c.active}:c);let i={...s.activeHook,param:o},r=[];return s.webhook.find(c=>c.id===e)?r=s.webhook.map(c=>c.id===e?i:c):r=[i,...s.webhook],f("webhook",r),{activeHook:i,webhook:r}}),dispartWebhook:async(e,t,s,o)=>{const{timeout:i}=z.getState(),{getPerfilContato:r}=P.getState();if(S.getState().plugin_page){oa(e,t,s,o);return}const n=z.getState().webhook.find(b=>b.id===t);if(!n||!n.active)return;if(i&&clearTimeout(i),await oe("webhook",!0)===!0){a({timeout:setTimeout(()=>{},5e3)});return}const c=await p.Utils("get-card",e);c.number=c.id,delete c.id,c.eventID=n.id,s&&(c.eventDetails=s),c.perfilContato=r(e),n.param.forEach(b=>{b.active||delete c[b.id]});let d=500;const l={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)},u=await fetch(n.url,l).then(b=>{d=b.status}).then(()=>!0).catch(b=>(console.error("error",b),!1)),m=te.dayDate(),v=te.timeDate(),h={id:o||k(),status:!!u,code:d,userID:e,date:`${m.day}/${m.month}/${m.year} as ${v.hours}:${v.minutes}:${v.seconds}`};s&&(h.eventDetails=s),a(o?b=>{const G=b.webhook.map(E=>{if(E.id===t){const ae=E.sent.map(Ae=>Ae.id===o?h:Ae);return{...E,sent:ae}}return E});return f("webhook",G),{activeHook:G.find(E=>E.id===t),webhook:G}}:b=>{const G=b.webhook.map(E=>{if(E.id===t){const ae=E.sent;return ae.length>=30&&ae.pop(),{...E,sent:[h,...ae]}}return E});return f("webhook",G),{activeHook:G.find(E=>E.id===t),webhook:G}})}})),gi=async()=>{let e=(await B("webhook")||[]).map(s=>s.param.find(i=>i.id==="perfilContato")?s:{...s,param:[...s.param,{id:"perfilContato",active:!1}]});const t=e.find(s=>s.id==="metaAds")||De;z.setState({activeHook:t,webhook:e})},hi=a=>{f("webhook",a);const e=a.find(t=>t.id==="metaAds")||De;z.setState({activeHook:e,webhook:a})},oa=(a,e,t,s)=>{N("dispartWebhook",{userID:a,webhookID:e,eventDetails:t,sendID:s})},gt=()=>{var a=new KeyboardEvent("keydown",{code:"Escape",which:27,bubbles:!0,composed:!0,keyCode:27,cancelable:!0,key:"Escape"});document.dispatchEvent(a)},ia={trasferirAtendimento:{text:"",active:!1},finalizarAtendimento:{text:"",active:!1,arquivar:!1}},de=A()(a=>({atendimento:ia,activeTrasferencia:null,trasferencias:[],renderTrasferencia:e=>a(t=>{const{modal:s}=X.getState();return s?{trasferencias:[...t.trasferencias,e]}:{activeTrasferencia:e}}),alterRenderTrasferencia:()=>a(e=>({activeTrasferencia:e.trasferencias[0],trasferencias:e.trasferencias.slice(1)})),setFinalizarAtendimento:(e,t)=>a(s=>{const o={...s.atendimento,finalizarAtendimento:{...s.atendimento.finalizarAtendimento,[e]:t}};return f("atendimento",o),{atendimento:o}}),setTransferirAtendimento:(e,t)=>a(s=>{const o={...s.atendimento,trasferirAtendimento:{...s.atendimento.trasferirAtendimento,[e]:t}};return f("atendimento",o),{atendimento:o}}),finalizarAtendimento:e=>{const{atendimento:t}=de.getState(),{plugin_page:s}=S.getState();if(gt(),s?N("serviceCompleted",e):z.getState().dispartWebhook(e,"serviceCompleted",{type:"Finalizado"}),t.finalizarAtendimento.active){const o=`*_Atendimento Finalizado_* 
 `+t.finalizarAtendimento.text;p.Chat("sendTxt",{id:e,msg:o})}t.finalizarAtendimento.arquivar&&p.Chat("arquivar",e)},trasferirAtendimento:(e,t)=>{const{atendimento:s}=de.getState(),{plugin_page:o}=S.getState();if(gt(),o?N("serviceCompleted",e):z.getState().dispartWebhook(e,"serviceCompleted",{type:"Trasferido"}),s.trasferirAtendimento.active){const i=`*_Atendimento Transferido para ${t}_*: 
 ${s.trasferirAtendimento.text}`;p.Chat("sendTxt",{id:e,msg:i})}}}));(async()=>{const a=await B("atendimento")||void 0;a&&de.setState({atendimento:a})})();de.subscribe(a=>{a.activeTrasferencia&&X.getState().openRendertype("receive_atendimento",!1)});const vi=a=>{de.setState({atendimento:a}),f("atendimento",a)},ra=x.lazy(() => __vitePreload(()=>import(chrome.runtime.getURL("content/assets/js/v_7_3_4_7_6e7deaa1-1876-4289-adc9-5c3b896aa7ed47.js")),[]));function na(){return g.jsx(x.Suspense,{fallback:g.jsx(g.Fragment,{}),children:g.jsx(ra,{})})}const ca=x.lazy(() => __vitePreload(()=>import(chrome.runtime.getURL("content/assets/js/v_7_3_4_7_6e7deaa1-1876-4289-adc9-5c3b896aa7ed48.js")),[]));function da(){return g.jsx(x.Suspense,{fallback:g.jsx(g.Fragment,{}),children:g.jsx(ca,{})})}const la=x.lazy(() => __vitePreload(()=>import(chrome.runtime.getURL("content/assets/js/v_7_3_4_7_6e7deaa1-1876-4289-adc9-5c3b896aa7ed49.js")),[]));function ua(){return g.jsx(x.Suspense,{fallback:g.jsx(g.Fragment,{}),children:g.jsx(la,{})})}const pa=x.lazy(() => __vitePreload(()=>import(chrome.runtime.getURL("content/assets/js/v_7_3_4_7_6e7deaa1-1876-4289-adc9-5c3b896aa7ed50.js")),[]));function ma(){return g.jsx(x.Suspense,{fallback:g.jsx(g.Fragment,{}),children:g.jsx(pa,{})})}const fa=x.lazy(() => __vitePreload(()=>import(chrome.runtime.getURL("content/assets/js/v_7_3_4_7_6e7deaa1-1876-4289-adc9-5c3b896aa7ed51.js")),[]));function ga(){return g.jsx(x.Suspense,{fallback:g.jsx(g.Fragment,{}),children:g.jsx(fa,{})})}const ha=x.lazy(() => __vitePreload(()=>import(chrome.runtime.getURL("content/assets/js/v_7_3_4_7_6e7deaa1-1876-4289-adc9-5c3b896aa7ed52.js")),[]));function va(){return g.jsx(x.Suspense,{fallback:g.jsx(g.Fragment,{}),children:g.jsx(ha,{})})}const Aa=x.lazy(() => __vitePreload(()=>import(chrome.runtime.getURL("content/assets/js/v_7_3_4_7_6e7deaa1-1876-4289-adc9-5c3b896aa7ed53.js")),[]));function ba(){return g.jsx(x.Suspense,{fallback:g.jsx(g.Fragment,{}),children:g.jsx(Aa,{})})}const X=A()(a=>({modal:null,btnClose:!0,auxFunc:{mounted:null,desmouted:null},open:(e,t=!0,s={mounted:null,desmouted:null})=>a(()=>(s.mounted&&s.mounted(),{modal:e,btnClose:t,auxFunc:s})),close:()=>a(e=>(e.auxFunc.desmouted&&e.auxFunc.desmouted(),{modal:null})),openRendertype:(e,t=!0,s={mounted:null,desmouted:null})=>{let o;switch(e){case"Active_IA":o=g.jsx(da,{});break;case"user_free":o=g.jsx(ma,{});break;case"access_duplicate":o=g.jsx(ua,{});break;case"receive_atendimento":o=g.jsx(ba,{});break;case"Modelo_Selecao":o=g.jsx(va,{});break;case"assinatura":o=g.jsx(na,{});break;case"login":o=g.jsx(ga,{});break}X.getState().open(o,t,s)}}));function Ai(){const{modal:a,btnClose:e,close:t}=X(),s=x.useRef(null),o=x.useRef(null);return x.useEffect(()=>{const i=r=>{const n=document.querySelector(".iziToast-wrapper"),c=document.querySelector('section[data-id="Modal Options"]'),d=document.querySelector('section[data-id="Modal Emoji"]'),l=document.querySelector('section[data-id="Modal Externo"]');e&&s.current&&!o.current.contains(r.target)&&(!n||!n.contains(r.target))&&!c&&!d&&!l&&t()};return a&&document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[a]),a&&g.jsx("section",{"data-id":"Modal",children:g.jsx("dialog",{id:"my_modal_5",ref:s,className:"animate__animated animate__zoomIn modal modal-bottom sm:modal-middle !absolute overflow-hidden !opacity-100 !pointer-events-auto !visible",children:g.jsxs("div",{ref:o,className:"modal-box relative overflow-hidden !max-w-none !max-h-none !w-fit !h-fit",children:[g.jsx("span",{className:"absolute w-5 h-5 top-3 right-3 pulse !cursor-pointer",onClick:t,children:g.jsx(Mt,{className:"w-full h-full text-[var(--primary-strong)]"})}),g.jsx("div",{className:"w-full h-full",children:a})]})})})}X.subscribe(a=>{const{trasferencias:e,alterRenderTrasferencia:t}=de.getState();e.length!==0&&!a.modal&&t()});async function Sa(a){try{return(await Me.post(`${ze.backend}api/auth/validacao`,{...a},{headers:{"Content-Type":"application/json",accept:"application/json"}})).data}catch{return{success:!0,message:"Validação realizada com sucesso",msg_id:"validacao_successo"}}}const ke={realizou_login:!1,estado:!1,login:"",senha:"",token:""},w=A()(a=>({user:ke,setUser:e=>{const t=ue.encryptData(e);Q("wpp-client","client",[t]),chrome.runtime.sendMessage({action:"post-user",user:e}),a({user:e})},setRemoveUser:()=>{const e={...ke,realizou_login:!0};Q("wpp-client","client",[ue.encryptData(e)]),chrome.runtime.sendMessage({action:"post-user",user:e}),a(t=>({...t,user:e}))},setUserPluginPage:e=>a({user:e})})),Rt=async a=>{const{language:e}=F.getState(),{label:t}=be.getState(),{setUser:s}=w.getState(),{openRendertype:o}=X.getState();if(!a.estado){a.realizou_login&&o("login");return}const i=await Sa({email:a.login,token:a.token,chromeStoreID:t.chromeStoreID});i.success?s(a):(s(ke),i.msg_id==="login_duplicado"?o("access_duplicate"):i.plugin_origem?(O({type:"Error",message:e[i.msg_id]+i.plugin_origem,position:"top-right"}),o("login")):(O({type:"Error",message:e[i.msg_id],position:"top-right"}),o("login")))},bi=async()=>{let a=ke;const e=await ce("wpp-client","client");e[0]&&e[0][0]&&(a=ue.decryptData(e[0][0])),Rt(a)};chrome.runtime.onMessage.addListener(async a=>{a.action==="get-user"&&chrome.runtime.sendMessage({action:a.action,response:JSON.stringify(w.getState().user),id:a.id}),a.action==="post-user"&&S.getState().plugin_page&&w.getState().setUserPluginPage(a.user),a.action==="license_update"&&w.getState().user.estado&&Rt(w.getState().user)});const ya=x.lazy(() => __vitePreload(()=>import(chrome.runtime.getURL("content/assets/js/v_7_3_4_7_6e7deaa1-1876-4289-adc9-5c3b896aa7ed54.js")),[]));function ht({notificacao:a}){return g.jsx(x.Suspense,{fallback:g.jsx(g.Fragment,{}),children:g.jsx(ya,{notificacao:a})})}const ee=A()((a,e)=>({notificacoes_modal:[],notificacoes_box:[],notificacoes_inbox:[],modal:null,active_inbox_notify:null,notificacoes_modalIDVisible:[],notificacoes_boxIDVisible:[],notificacoes_inboxIDVisible:[],getNotificaoes:async()=>{try{const{label:t}=be.getState();if(t.chromeStoreID.length===0)return;const o=(await Me.get(`${ze.backend}api/notificacao/get?wl_id=${t.chromeStoreID}`,{headers:{"Content-Type":"application/json",accept:"application/json"}})).data.notificacoes;a({notificacoes_modal:o.filter(i=>i.viewer==="MODAL"),notificacoes_box:o.filter(i=>i.viewer==="NOTIFY"),notificacoes_inbox:o.filter(i=>i.viewer==="INBOX")}),e().renderNotificacoes_modal(),e().renderNotificacoes_inbox()}catch(t){console.error("Error ao capturar as notificações",t)}},renderNotificacoes_modal:()=>a(t=>{const{user:s}=w.getState(),i=t.notificacoes_modal.filter(r=>r.client==="PREMIUM"&&s.estado||r.client==="FREE"&&s.estado===!1||r.client==="ALL").filter(r=>!t.notificacoes_modalIDVisible.includes(r.id));return{notificacoes_modal:i,modal:i.length!==0?g.jsx(ht,{notificacao:i[0]}):null}}),closeNotificacoes_modal:()=>{a({modal:null});const{notificacoes_modal:t}=e(),s=[...t];s.shift(),ee.getState().setNotificacoes_ModalVisible(t[0].id),setTimeout(()=>{a({notificacoes_modal:s,modal:s.length!==0?g.jsx(ht,{notificacao:s[0]}):null})},2e3)},setNotificacoes_ModalVisible:t=>a(s=>{const o=[t,...s.notificacoes_modalIDVisible];return localStorage.setItem("notificacoes_modal",JSON.stringify(o)),{notificacoes_modalIDVisible:o}}),renderNotificacoes_box:()=>{const{user:t}=w.getState();return ee.getState().notificacoes_box.filter(i=>i.client==="PREMIUM"&&t.estado||i.client==="FREE"&&t.estado===!1||i.client==="ALL")},setNotificacoes_boxVisible:t=>a(s=>{if(s.notificacoes_boxIDVisible.includes(t))return{};const o=[t,...s.notificacoes_boxIDVisible];return localStorage.setItem("notificacoes_box",JSON.stringify(o)),{notificacoes_boxIDVisible:o}}),isBoxVisible:t=>ee.getState().notificacoes_boxIDVisible.includes(t),renderNotificacoes_inbox:()=>a(t=>{const{user:s}=w.getState(),i=t.notificacoes_inbox.filter(r=>r.client==="PREMIUM"&&s.estado||r.client==="FREE"&&s.estado===!1||r.client==="ALL").filter(r=>!t.notificacoes_inboxIDVisible.includes(r.id));return{notificacoes_inbox:i,active_inbox_notify:i.length!==0?i[0]:null}}),closeNotificacoes_inbox:()=>{a({active_inbox_notify:null});const{notificacoes_inbox:t,setNotificacoes_inboxVisible:s}=e(),o=[...t];o.shift(),s(t[0].id),setTimeout(()=>{a({notificacoes_inbox:o,active_inbox_notify:o.length!==0?o[0]:null})},2e3)},setNotificacoes_inboxVisible:t=>a(s=>{const o=[t,...s.notificacoes_inboxIDVisible];return localStorage.setItem("notificacoes_inbox",JSON.stringify(o)),{notificacoes_inboxIDVisible:o}})}));function Si(){const{modal:a}=ee();return a&&g.jsx("section",{"data-id":"Notificacao-Modal",children:g.jsx("dialog",{id:"Notificacao-Modal",className:"z-[99999999999999] animate__animated animate__zoomIn modal modal-bottom sm:modal-middle !absolute overflow-hidden !opacity-100 !pointer-events-auto !visible",children:g.jsxs("div",{className:"modal-box relative overflow-hidden !max-w-none !max-h-none !w-fit !h-fit !pr-3",children:[g.jsx("span",{className:"absolute w-5 h-5 top-3 right-3 pulse !cursor-pointer",onClick:()=>ee.getState().closeNotificacoes_modal(),children:g.jsx(Mt,{className:"w-full h-full text-[var(--primary-strong)]"})}),g.jsx("div",{className:"w-full h-full",children:a})]})})})}chrome.runtime.onMessage.addListener(a=>{a.action==="Remote-Notificacao"&&ee.getState().getNotificaoes()});(()=>{const a=JSON.parse(localStorage.getItem("notificacoes_modal")),e=JSON.parse(localStorage.getItem("notificacoes_box")),t=JSON.parse(localStorage.getItem("notificacoes_inbox"));a&&a.length!==0&&ee.setState({notificacoes_modalIDVisible:a}),e&&e.length!==0&&ee.setState({notificacoes_boxIDVisible:e}),t&&t.length!==0&&ee.setState({notificacoes_inboxIDVisible:t})})();const wa=async(a,e,t,s,o=!1)=>{const r=y.getState().crm.map(n=>n.id===a?{...n,name:e,desc:t,hexColor:s}:n);$({stopPropag:o,action:"editCrm",waitForResponse:!1,data:{crmID:a,name:e,desc:t,hexColor:s}}),!o&&f("crm",r),y.setState({crm:r})},Ca=async(a,e=!1)=>{const s=y.getState().crm.filter(o=>o.id!==a);$({stopPropag:e,action:"removeCrm",waitForResponse:!1,data:a}),!e&&f("crm",s),y.setState({crm:s})},xa=async({id:a=k(),ativeCRM:e,name:t,hexColor:s},o=!1)=>{const r=y.getState().crm.map(n=>{if(n.id===e){const c={id:a,name:t,hexColor:s,chats:[]};return{...n,list:[...n.list,c]}}return n});$({stopPropag:o,action:"addNewTabCRM",waitForResponse:!1,data:{id:a,ativeCRM:e,name:t,hexColor:s}}),!o&&f("crm",r),y.setState({crm:r})},Ma=async(a,e=!1)=>{const s=[...y.getState().crm,...a].reduce((o,i)=>o.find(n=>n.id===i.id)?o:o.concat([i]),[]);$({stopPropag:e,action:"setCrm",waitForResponse:!1,data:a}),!e&&f("crm",s),y.setState({crm:s})},Ta=async(a,e,t,s=!1)=>{const i=y.getState().crm.map(r=>r.id===a?{...r,list:r.list.map(n=>n.id===e?{...n,name:t}:n)}:r);$({stopPropag:s,action:"editTabCRM",waitForResponse:!1,data:{crmID:a,abaID:e,name:t}}),!s&&f("crm",i),y.setState({crm:i})},ka=async(a,e,t,s=!1)=>{const i=y.getState().crm.map(r=>r.id===a?{...r,list:r.list.map(n=>n.id===e?{...n,chats:n.chats.filter(c=>c.id!==t)}:n)}:r);$({stopPropag:s,action:"removeChatTabCRM",waitForResponse:!1,data:{crmID:a,abaID:e,chatID:t}}),!s&&f("crm",i),y.setState({crm:i})},_a=async(a,e,t,s=!1)=>{const i=y.getState().crm.map(r=>r.id===a?{...r,list:r.list.map(n=>n.id===e?{...n,hexColor:t}:n)}:r);$({stopPropag:s,action:"changeColorTabCRM",waitForResponse:!1,data:{crmID:a,abaID:e,hexColor:t}}),!s&&f("crm",i),y.setState({crm:i})},Ut=async(a,e,t,s,o=!1)=>{const i=y.getState().crm;a=a.replace("@c.us","").replace("@g.us","");let r;e?r=i.map(n=>({...n,list:n.list.map(c=>({...c,chats:c.chats.filter(d=>d.id!==a)}))})):r=i.map(n=>n.id===t?{...n,list:n.list.map(c=>c.id===s?{...c,chats:c.chats.filter(d=>d.id!==a)}:c)}:n),$({stopPropag:o,action:"setRemoveUserCRM",waitForResponse:!1,data:{userID:a,isAll:e,crmID:t,abaID:s}}),!o&&f("crm",r),y.setState({crm:r})},Ft=a=>{const e=y.getState().crm;let t=0;return e.map(s=>{s.list.map(o=>{o.chats.map(i=>{i.id===a&&t++})})}),t},Et=async(a,e,t,s,o=!1)=>{const i=y.getState().crm;a=a.replace("@c.us","").replace("@g.us","");let r=i.map(n=>n.id===e?{...n,list:n.list.map(c=>{if(c.id===t&&!c.chats.some(l=>l.id===a)){let l=[...c.chats];return l.splice(s,0,{id:a}),{...c,chats:l}}return c})}:n);$({stopPropag:o,action:"setNewUserCRM",waitForResponse:!1,data:{userID:a,crmID:e,abaID:t,insertPosition:s}}),!o&&f("crm",r),y.setState({crm:r})},Ra=(a,e,t,s,o,i=!1)=>{const n=y.getState().crm.map(c=>({...c,list:c.list.map(d=>{if(d.id===e&&!o){const l=d.chats.filter(u=>u.id!==a.id);return{...d,chats:l}}else if(d.id===t){const l=[...d.chats];return l.some(m=>m.id===a.id)||l.splice(s,0,a),{...d,chats:l}}return d})}));$({stopPropag:i,action:"moveUserTabCRM",waitForResponse:!1,data:{chat:a,source:e,destination:t,insertPosition:s,duplicate:o}}),!i&&f("crm",n),y.setState({crm:n})},Ua=(a,e,t,s,o=!1)=>{const r=y.getState().crm.map(n=>n.id===a?{...n,list:n.list.map(c=>{if(c.id===e){const d=[...c.chats],[l]=d.splice(t,1);return d.splice(s,0,l),{...c,chats:d}}return c})}:n);$({stopPropag:o,action:"orderUserInTabCRM",waitForResponse:!1,data:{crmID:a,columnID:e,indexHome:t,indexDestination:s}}),!o&&f("crm",r),y.setState({crm:r})},Fa=(a,e,t,s=!1)=>{const i=y.getState().crm.map(r=>{if(r.id===a){const n=[...r.list],[c]=n.splice(e,1);return n.splice(t,0,c),{...r,list:n}}return r});$({stopPropag:s,action:"sortUserTabsCRM",waitForResponse:!1,data:{crmID:a,indexHome:e,indexDestination:t}}),!s&&f("crm",i),y.setState({crm:i})},Ea=(a,e,t=!1)=>{const o=y.getState().crm.map(i=>i.id===a?{...i,list:i.list.filter(r=>r.id!==e)}:i);$({stopPropag:t,action:"deleteTabCRM",waitForResponse:!1,data:{crmID:a,abaID:e}}),!t&&f("crm",o),y.setState({crm:o})},La=jt({setCrm:a=>{Ma(a.data,!0)},editCrm:a=>{const{crmID:e,name:t,desc:s,hexColor:o}=a.data;wa(e,t,s,o,!0)},removeCrm:a=>{Ca(a.data,!0)},addNewTabCRM:a=>{xa(a.data,!0)},editTabCRM:a=>{const{crmID:e,abaID:t,name:s}=a.data;Ta(e,t,s,!0)},removeChatTabCRM:a=>{const{crmID:e,abaID:t,chatID:s}=a.data;ka(e,t,s,!0)},changeColorTabCRM:a=>{const{crmID:e,abaID:t,hexColor:s}=a.data;_a(e,t,s,!0)},setRemoveUserCRM:a=>{const{userID:e,isAll:t,crmID:s,abaID:o}=a.data;Ut(e,t,s,o,!0)},setNewUserCRM:a=>{const{userID:e,crmID:t,abaID:s,insertPosition:o}=a.data;Et(e,t,s,o,!0)},moveUserTabCRM:a=>{const{chat:e,source:t,destination:s,insertPosition:o,duplicate:i}=a.data;Ra(e,t,s,o,i,!0)},orderUserInTabCRM:a=>{const{crmID:e,columnID:t,indexHome:s,indexDestination:o}=a.data;Ua(e,t,s,o,!0)},sortUserTabsCRM:a=>{const{crmID:e,indexHome:t,indexDestination:s}=a.data;Fa(e,t,s,!0)},deleteTabCRM:a=>{const{crmID:e,abaID:t}=a.data;Ea(e,t,!0)}});chrome.runtime.onMessage.addListener(La);const y=A()(()=>({crm:[]})),vt={assinatura:{type:"assinatura",propriedades:{active:!1,desativarAss:!1,persAss:{active:!1,nameAss:""}}},responderGrupos:{type:"responderGrupos",propriedades:{active:!1}},responderDias:{type:"responderDias",propriedades:{active:!1,segunda:{active:!1,periodoAtivacao:!1,horaInicio:"00:00",horaFim:"23:59"},terca:{active:!1,periodoAtivacao:!1,horaInicio:"00:00",horaFim:"23:59"},quarta:{active:!1,periodoAtivacao:!1,horaInicio:"00:00",horaFim:"23:59"},quinta:{active:!1,periodoAtivacao:!1,horaInicio:"00:00",horaFim:"23:59"},sexta:{active:!0,periodoAtivacao:!1,horaInicio:"00:00",horaFim:"23:59"},sabado:{active:!0,periodoAtivacao:!1,horaInicio:"00:00",horaFim:"23:59"},domingo:{active:!0,periodoAtivacao:!1,horaInicio:"00:00",horaFim:"23:59"}}},responderChatAtivo:{type:"responderChatAtivo",propriedades:{active:!1}},responderChatArquivado:{type:"responderChatArquivado",propriedades:{active:!1}},notResponderChatCRM:{type:"notResponderChatCRM",propriedades:{active:!1}},notResponderCRM:{type:"notResponderCRM",propriedades:{active:!1,crm:[]}},responderCRM:{type:"responderCRM",propriedades:{active:!1,crm:[]}},notResponderChatEtiquetado:{type:"notResponderChatEtiquetado",propriedades:{active:!1}},notResponderEtiqueta:{type:"notResponderEtiqueta",propriedades:{active:!1,labelID:[]}},responderEtiqueta:{type:"responderEtiqueta",propriedades:{active:!1,labelID:[]}}},ie=A()(a=>({model:"Create",activeColapse:"acionamento",setActiveColapse:e=>a(()=>({activeColapse:e})),activeAutoAtt:{id:k(),nome:"",active:!0,acionamento:[],acao:[],regras:vt,usedLenght:0},setActiveAutoAtt:(e,t)=>a(s=>({activeAutoAtt:{...s.activeAutoAtt,[e]:t}})),setResetDefaultAutoAtt:()=>a(e=>({model:"Create",activeAutoAtt:{id:k(),nome:"",active:!0,acionamento:[],acao:[],regras:vt,usedLenght:0},activeColapse:"acionamento"})),setEditAutoAtt:e=>a(()=>(e.regras.notResponderChatCRM||(e.regras={...e.regras,notResponderChatCRM:{type:"notResponderChatCRM",propriedades:{active:!1}},notResponderCRM:{type:"notResponderCRM",propriedades:{active:!1,crm:[]}},responderCRM:{type:"responderCRM",propriedades:{active:!1,crm:[]}},notResponderChatEtiquetado:{type:"notResponderChatEtiquetado",propriedades:{active:!1}},responderEtiqueta:{type:"responderEtiqueta",propriedades:{active:!1,labelID:[]}},notResponderEtiqueta:{type:"notResponderEtiqueta",propriedades:{active:!1,labelID:[]}}}),e.regras.assinatura||(e.regras.assinatura={type:"assinatura",propriedades:{active:!1,desativarAss:!1,persAss:{active:!1,nameAss:""}}}),e.regras.responderChatArquivado||(e.regras.responderChatArquivado={type:"responderChatArquivado",propriedades:{active:!1}}),{model:"Edit",activeAutoAtt:e,activeColapse:"acionamento"})),setCreateAcionamento:e=>a(t=>({activeAutoAtt:{...t.activeAutoAtt,acionamento:[...t.activeAutoAtt.acionamento,{id:k(),type:e}]}})),setRemoveAcionamento:e=>a(t=>({activeAutoAtt:{...t.activeAutoAtt,acionamento:t.activeAutoAtt.acionamento.filter(s=>s.id!==e)}})),setAcionamentoText:(e,t)=>a(s=>{const o=s.activeAutoAtt.acionamento.map(i=>i.id===e?{...i,text:t}:i);return{activeAutoAtt:{...s.activeAutoAtt,acionamento:o}}}),setAcionamentoChave:(e,t)=>a(s=>{const o=s.activeAutoAtt.acionamento.map(i=>i.id===e?{...i,chaves:i.chaves?[t,...i.chaves]:[t]}:i);return{activeAutoAtt:{...s.activeAutoAtt,acionamento:o}}}),setAcionamentoRemoveChave:(e,t)=>a(s=>{const o=s.activeAutoAtt.acionamento.map(i=>i.id===e?{...i,chaves:i.chaves.filter(r=>r!==t)}:i);return{activeAutoAtt:{...s.activeAutoAtt,acionamento:o}}}),setAcionamentoanuncioID:(e,t)=>a(s=>{const o=s.activeAutoAtt.acionamento.map(i=>i.id===e?{...i,anuncioID:t}:i);return{activeAutoAtt:{...s.activeAutoAtt,acionamento:o}}}),setCreateAcao:(e,t={})=>a(s=>({activeAutoAtt:{...s.activeAutoAtt,acao:[...s.activeAutoAtt.acao,{id:k(),type:e,propriedades:t}]}})),setRemoveAcao:e=>a(t=>({activeAutoAtt:{...t.activeAutoAtt,acao:t.activeAutoAtt.acao.filter(s=>s.id!==e)}})),setAcaoPropriedades:(e,t)=>a(s=>({activeAutoAtt:{...s.activeAutoAtt,acao:s.activeAutoAtt.acao.map(o=>o.id===e?{...o,propriedades:{...o.propriedades,...t}}:o)}})),sortAcoes:e=>a(t=>{const s=[...t.activeAutoAtt.acao],o=Array.from(s),[i]=o.splice(e.source.index,1);return o.splice(e.destination.index,0,i),{activeAutoAtt:{...t.activeAutoAtt,acao:o}}}),setRegraUpdate:e=>a(t=>({activeAutoAtt:{...t.activeAutoAtt,regras:{...t.activeAutoAtt.regras,[e]:{...t.activeAutoAtt.regras[e],propriedades:{...t.activeAutoAtt.regras[e].propriedades,active:!t.activeAutoAtt.regras[e].propriedades.active}}}}})),setRegraUpdateEtiqueta:e=>a(t=>({activeAutoAtt:{...t.activeAutoAtt,regras:{...t.activeAutoAtt.regras,notResponderChatEtiquetado:{...t.activeAutoAtt.regras.notResponderChatEtiquetado,propriedades:{...t.activeAutoAtt.regras.notResponderChatEtiquetado.propriedades,active:e==="notResponderChatEtiquetado"?!t.activeAutoAtt.regras[e].propriedades.active:!1}},notResponderEtiqueta:{...t.activeAutoAtt.regras.notResponderEtiqueta,propriedades:{...t.activeAutoAtt.regras.notResponderEtiqueta.propriedades,active:e==="notResponderEtiqueta"?!t.activeAutoAtt.regras[e].propriedades.active:!1}},responderEtiqueta:{...t.activeAutoAtt.regras.responderEtiqueta,propriedades:{...t.activeAutoAtt.regras.responderEtiqueta.propriedades,active:e==="responderEtiqueta"?!t.activeAutoAtt.regras[e].propriedades.active:!1}}}}})),setRegraUpdateCRM:e=>a(t=>({activeAutoAtt:{...t.activeAutoAtt,regras:{...t.activeAutoAtt.regras,notResponderChatCRM:{...t.activeAutoAtt.regras.notResponderChatCRM,propriedades:{...t.activeAutoAtt.regras.notResponderChatCRM.propriedades,active:e==="notResponderChatCRM"?!t.activeAutoAtt.regras[e].propriedades.active:!1}},notResponderCRM:{...t.activeAutoAtt.regras.notResponderCRM,propriedades:{...t.activeAutoAtt.regras.notResponderCRM.propriedades,active:e==="notResponderCRM"?!t.activeAutoAtt.regras[e].propriedades.active:!1}},responderCRM:{...t.activeAutoAtt.regras.responderCRM,propriedades:{...t.activeAutoAtt.regras.responderCRM.propriedades,active:e==="responderCRM"?!t.activeAutoAtt.regras[e].propriedades.active:!1}}}}})),setRegrasUpdateDias:e=>{a(t=>{const s=t.activeAutoAtt.regras.responderDias.propriedades[e].active;return{activeAutoAtt:{...t.activeAutoAtt,regras:{...t.activeAutoAtt.regras,responderDias:{...t.activeAutoAtt.regras.responderDias,propriedades:{...t.activeAutoAtt.regras.responderDias.propriedades,[e]:{...t.activeAutoAtt.regras.responderDias.propriedades[e],active:!s}}}}}}})},setRegrasUpdateHorario:(e,t,s)=>{a(o=>({activeAutoAtt:{...o.activeAutoAtt,regras:{...o.activeAutoAtt.regras,responderDias:{...o.activeAutoAtt.regras.responderDias,propriedades:{...o.activeAutoAtt.regras.responderDias.propriedades,[e]:{...o.activeAutoAtt.regras.responderDias.propriedades[e],horaInicio:t,horaFim:s}}}}}}))},setRegrasUpdateAssinatura:e=>{a(t=>{const s=t.activeAutoAtt.regras.assinatura.propriedades,o={...s};return e==="persAss"?(o.persAss={...s.persAss,active:!s.persAss.active},o.persAss.active&&(o.desativarAss=!1)):e==="desativarAss"&&(o.persAss={...s.persAss,active:!1},o.desativarAss=!s.desativarAss),{activeAutoAtt:{...t.activeAutoAtt,regras:{...t.activeAutoAtt.regras,assinatura:{...t.activeAutoAtt.regras.assinatura,propriedades:o}}}}})},setAssinaturaName:e=>{a(t=>{const s=t.activeAutoAtt.regras.assinatura.propriedades;return{activeAutoAtt:{...t.activeAutoAtt,regras:{...t.activeAutoAtt.regras,assinatura:{...t.activeAutoAtt.regras.assinatura,propriedades:{...s,persAss:{...s.persAss,nameAss:e}}}}}}})},setPeriodoAtivacao:e=>{a(t=>{const s=t.activeAutoAtt.regras.responderDias.propriedades[e];return{activeAutoAtt:{...t.activeAutoAtt,regras:{...t.activeAutoAtt.regras,responderDias:{...t.activeAutoAtt.regras.responderDias,propriedades:{...t.activeAutoAtt.regras.responderDias.propriedades,[e]:{...s,periodoAtivacao:!s.periodoAtivacao}}}}}}})},validateAutoAtt:()=>{const{acao:e}=_e.getState(),{activeAutoAtt:t}=ie.getState(),s=t.regras.assinatura.propriedades||null,o=t.regras.responderDias.propriedades;return t.nome.length<3?{success:!1,message:"O nome deve ter mais de 3 caracteres"}:t.acionamento.length===0?(ie.getState().setActiveColapse("acionamento"),{success:!1,message:"O auto atendimento deve ter ao menos um acionamento"}):e.length===0?(ie.getState().setActiveColapse("script"),{success:!1,message:"O auto atendimento deve ter ao menos uma ação"}):s!=null&&s.active&&s.persAss.active&&!s.persAss.nameAss?(ie.getState().setActiveColapse("regras"),{success:!1,message:"O nome da assinatura deve ser preenchido"}):s!=null&&s.active&&!(s.desativarAss||s.persAss.active)?(ie.getState().setActiveColapse("regras"),{success:!1,message:"A assinatura deve ter ao menos uma opção ativa"}):o.active&&!["segunda","terca","quarta","quinta","sexta","sabado","domingo"].some(n=>o[n].active)?(ie.getState().setActiveColapse("regras"),{success:!1,message:"Deve ter ao menos um dia ativo"}):{success:!0}},addEtiqueta:(e,t)=>a(s=>({activeAutoAtt:{...s.activeAutoAtt,regras:{...s.activeAutoAtt.regras,[e]:{...s.activeAutoAtt.regras[e],propriedades:{...s.activeAutoAtt.regras[e].propriedades,labelID:[...s.activeAutoAtt.regras[e].propriedades.labelID,t]}}}}})),removeEtiqueta:(e,t)=>a(s=>({activeAutoAtt:{...s.activeAutoAtt,regras:{...s.activeAutoAtt.regras,[e]:{...s.activeAutoAtt.regras[e],propriedades:{...s.activeAutoAtt.regras[e].propriedades,labelID:s.activeAutoAtt.regras[e].propriedades.labelID.filter(o=>o!==t)}}}}})),addCRM:(e,t)=>a(s=>({activeAutoAtt:{...s.activeAutoAtt,regras:{...s.activeAutoAtt.regras,[e]:{...s.activeAutoAtt.regras[e],propriedades:{...s.activeAutoAtt.regras[e].propriedades,crm:[...s.activeAutoAtt.regras[e].propriedades.crm,t]}}}}})),removeCRM:(e,t)=>a(s=>({activeAutoAtt:{...s.activeAutoAtt,regras:{...s.activeAutoAtt.regras,[e]:{...s.activeAutoAtt.regras[e],propriedades:{...s.activeAutoAtt.regras[e].propriedades,crm:s.activeAutoAtt.regras[e].propriedades.crm.filter(o=>o!==t)}}}}}))})),Ne={cancelAfterChat:{type:"cancelAfterChat",propriedades:{active:!1}},responderGrupos:{type:"responderGrupos",propriedades:{active:!1}},assinatura:{type:"assinatura",propriedades:{active:!1,desativarAss:!1,persAss:{active:!1,nameAss:""}}}},re=A()((a,e)=>({model:"Create",activeColapse:"funil",addAbaInFunil:t=>a(s=>{try{const o={...s.activeFollowUp.funil};return o.abas.some(r=>r.id===t.id)||o.abas.push(t),{activeFollowUp:{...s.activeFollowUp,funil:o}}}catch(o){console.error("Error in addAbaInFunil",o)}}),removeAbaInFunil:t=>a(s=>{try{const o={...s.activeFollowUp.funil};return o.abas=o.abas.filter(i=>i.id!==t),{activeFollowUp:{...s.activeFollowUp,funil:o}}}catch(o){console.error("Error in removeAbaInFunil",o)}}),addLabelInFunil:t=>a(s=>{try{const o={...s.activeFollowUp.funil};return o.etiquetas.some(r=>r.id===t.id)||o.etiquetas.push(t),{activeFollowUp:{...s.activeFollowUp,funil:o}}}catch(o){console.error("Error in addLabelInFunil",o)}}),LabelOrTabIsExist:t=>{const o=e().activeFollowUp.funil,i=o.abas.some(n=>n.id===t),r=o.etiquetas.some(n=>n.id===t);return i||r},removeLabelInFunil:t=>a(s=>{try{const o={...s.activeFollowUp.funil};return o.etiquetas=o.etiquetas.filter(i=>i.id!==t),{activeFollowUp:{...s.activeFollowUp,funil:o}}}catch(o){console.error("Error in removeLabelInFunil",o)}}),activeTabOrLabel:S.getState().isBusiness?"labels":"userTabs",setActiveTabOrLabel:t=>a(()=>({activeTabOrLabel:t})),setActiveColapse:t=>a(()=>({activeColapse:t})),activeFollowUp:{id:k(),nome:"",active:!0,funil:{id:k(),abas:[],etiquetas:[]},acionamento:{type:"dispararAoEntrar",timing:{days:0,hours:0,minutes:0}},acao:[],regras:Ne},setActiveFollowUp:(t,s)=>a(o=>({activeFollowUp:{...o.activeFollowUp,[t]:s}})),setResetDefaultFollowUp:()=>a(t=>({model:"Create",activeFollowUp:{id:k(),nome:"",active:!0,funil:{id:k(),abas:[],etiquetas:[]},acionamento:{type:"dispararAoEntrar",timing:{days:0,hours:0,minutes:0}},acao:[],regras:Ne},activeColapse:"funil"})),setEditFollowUp:t=>a(()=>(t.regras||(t.regras=Ne),t.regras.cancelAfterChat||(t.regras.cancelAfterChat={type:"cancelAfterChat",propriedades:{active:!1}}),t.regras.responderGrupos||(t.regras.responderGrupos={type:"responderGrupos",propriedades:{active:!1}}),t.regras.assinatura||(t.regras.assinatura={type:"assinatura",propriedades:{active:!1,desativarAss:!1,persAss:{active:!1,nameAss:""}}}),t.funil||(t.funil={id:k(),abas:[],etiquetas:[]}),{model:"Edit",activeFollowUp:t,activeColapse:"funil"})),setTimingAcionamento:t=>a(s=>({activeFollowUp:{...s.activeFollowUp,acionamento:{...s.activeFollowUp.acionamento,timing:t}}})),setDispararAcionamento:t=>a(s=>({activeFollowUp:{...s.activeFollowUp,acionamento:{...s.activeFollowUp.acionamento,type:t}}})),setCreateAcao:(t,s={})=>a(o=>({activeFollowUp:{...o.activeFollowUp,acao:[...o.activeFollowUp.acao,{id:k(),type:t,propriedades:s}]}})),setRemoveAcao:t=>a(s=>({activeFollowUp:{...s.activeFollowUp,acao:s.activeFollowUp.acao.filter(o=>o.id!==t)}})),setAcaoPropriedades:(t,s)=>a(o=>({activeFollowUp:{...o.activeFollowUp,acao:o.activeFollowUp.acao.map(i=>i.id===t?{...i,propriedades:{...i.propriedades,...s}}:i)}})),sortAcoes:t=>a(s=>{const o=[...s.activeFollowUp.acao],i=Array.from(o),[r]=i.splice(t.source.index,1);return i.splice(t.destination.index,0,r),{activeFollowUp:{...s.activeFollowUp,acao:i}}}),setRegraUpdate:t=>a(s=>({activeFollowUp:{...s.activeFollowUp,regras:{...s.activeFollowUp.regras,[t]:{...s.activeFollowUp.regras[t],propriedades:{...s.activeFollowUp.regras[t].propriedades,active:!s.activeFollowUp.regras[t].propriedades.active}}}}})),setRegrasUpdateAssinatura:t=>{a(s=>{const o=s.activeFollowUp.regras.assinatura.propriedades,i={...o};return t==="persAss"?(i.persAss={...o.persAss,active:!o.persAss.active},i.persAss.active&&(i.desativarAss=!1)):t==="desativarAss"&&(i.persAss={...o.persAss,active:!1},i.desativarAss=!o.desativarAss),{activeFollowUp:{...s.activeFollowUp,regras:{...s.activeFollowUp.regras,assinatura:{...s.activeFollowUp.regras.assinatura,propriedades:i}}}}})},setAssinaturaName:t=>{a(s=>{const o=s.activeFollowUp.regras.assinatura.propriedades;return{activeFollowUp:{...s.activeFollowUp,regras:{...s.activeFollowUp.regras,assinatura:{...s.activeFollowUp.regras.assinatura,propriedades:{...o,persAss:{...o.persAss,nameAss:t}}}}}}})},validateFollowUp:()=>{const{acao:t}=Re.getState(),{activeFollowUp:s}=re.getState(),o=s.regras.assinatura.propriedades||null,i=s.acionamento.type||null,{days:r,hours:n,minutes:c}=s.acionamento.timing||null;return s.nome.length<3?{success:!1,message:"O nome deve ter mais de 3 caracteres"}:s.funil.abas.length===0&&s.funil.etiquetas.length===0?(re.getState().setActiveColapse("funil"),{success:!1,message:"O funil deve ter ao menos uma aba ou etiqueta adicionada"}):!i&&!r&&!n&&!c?(re.getState().setActiveColapse("acionamento"),{success:!1,message:"O acionamento deve ter ao menos um tempo configurado"}):t.length===0?(re.getState().setActiveColapse("script"),{success:!1,message:"O follow up deve ter ao menos uma ação"}):o!=null&&o.active&&o.persAss.active&&!o.persAss.nameAss?(re.getState().setActiveColapse("regras"),{success:!1,message:"O nome da assinatura deve ser preenchido"}):o!=null&&o.active&&!(o.desativarAss||o.persAss.active)?(re.getState().setActiveColapse("regras"),{success:!1,message:"A assinatura deve ter ao menos uma opção ativa"}):{success:!0}}})),Se={useAcaoRespostaRapida:{size:"medium",arrow:!1,overflow:!1},useAcaoAutoAtendimento:{size:"large",inputName:"my-accordion-2",OnOpen:()=>ie.getState().setActiveColapse("script"),arrow:!0,overflow:!0},useAcaoFollowUp:{size:"large",inputName:"my-accordion-2",OnOpen:()=>re.getState().setActiveColapse("script"),arrow:!0,overflow:!0},useAcaoEditAndSendRes:{size:"large",arrow:!1,overflow:!0},useAcaoEnvioEmMassa:{size:"medium",arrow:!1,overflow:!0,style:{primaria:"var(--conversation-panel-background)",secundaria:"var(--outgoing-background)",hover:"var(--incoming-background)"}}},ye=a=>A()((e,t)=>({model:a,setModel:s=>e({model:s}),acao:[],setAcao:s=>e({acao:s}),setCreateAcao:(s,o={})=>e(i=>({acao:[...i.acao,{id:k(),type:s,propriedades:o}]})),setRemoveAcao:s=>e(o=>({acao:o.acao.filter(i=>i.id!==s)})),setAcaoPropriedades:(s,o)=>e(i=>({acao:i.acao.map(r=>r.id===s?{...r,propriedades:{...r.propriedades,...o}}:r)})),clearAcao:()=>e({acao:[]}),sortAcoes:s=>e(o=>{const i=[...o.acao],r=Array.from(i),[n]=r.splice(s.oldIndex,1);return r.splice(s.newIndex,0,n),{acao:r}})})),Lt=ye(Se.useAcaoRespostaRapida),_e=ye(Se.useAcaoAutoAtendimento),Re=ye(Se.useAcaoFollowUp),Na=ye(Se.useAcaoEditAndSendRes),qa=ye(Se.useAcaoEnvioEmMassa),yi={useAcaoRespostaRapida:Lt,useAcaoAutoAtendimento:_e,useAcaoFollowUp:Re,useAcaoEditAndSendRes:Na,useAcaoEnvioEmMassa:qa},ge=A()(a=>({autoAtendimento:[],createAutoAtendimento:e=>a(t=>{const{acao:s}=_e.getState(),i=[{...e,acao:s},...t.autoAtendimento];return f("autoatendimento",i),{autoAtendimento:i}}),editAutoAtendimento:e=>a(t=>{const{acao:s}=_e.getState(),o={...e,acao:s},i=t.autoAtendimento.map(r=>r.id===o.id?o:r);return f("autoatendimento",i),{autoAtendimento:i}}),deleteAutoAtendimento:e=>a(t=>{const s=t.autoAtendimento.filter(o=>o.id!==e);return f("autoatendimento",s),{autoAtendimento:s}}),duplicateAutoAtendimento:e=>a(t=>{const s=t.getAutoAtendimento(e),o=s.nome.includes("(Cópia")?s.nome.split(" (Cópia")[0]:s.nome,i=t.autoAtendimento.filter(c=>c.nome.startsWith(o+" (Cópia")).length,n=[{...s,id:k(),nome:`${o} (Cópia${i>0?` ${i+1}`:""})`,usedLenght:0},...t.autoAtendimento];return f("autoatendimento",n),{autoAtendimento:n}}),getAutoAtendimento:e=>ge.getState().autoAtendimento.find(s=>s.id===e),switchActive:e=>a(t=>{const s=t.autoAtendimento.map(o=>o.id===e?{...o,active:!o.active}:o);return f("autoatendimento",s),{autoAtendimento:s}}),updateUsedLenght:e=>a(t=>{const s=t.autoAtendimento.map(o=>o.id===e?{...o,usedLenght:o.usedLenght+1}:o);return f("autoatendimento",s),{autoAtendimento:s}})})),Ia=a=>{ge.setState({autoAtendimento:a}),f("autoatendimento",a)},wi=a=>{const e=ge.getState().autoAtendimento,t=new Set(e.map(s=>s.id));a.forEach(s=>{t.has(s.id)||(e.push(s),t.add(s.id))}),Ia(e)},Ci=async()=>{const a=await B("autoatendimento")||[];ge.setState({autoAtendimento:a})},Pa=A()((a,e)=>({quickReplies:[],addQuickReply:t=>a(s=>{const o=[...s.quickReplies,t];return f("respostasRapidas",o),{quickReplies:o}}),editQuickReply:t=>a(s=>{const o=s.quickReplies.map(i=>i.id===t.id?t:i);return f("respostasRapidas",o),{quickReplies:o}}),getQuickReply:(t,s)=>{const{quickReplies:o}=e(),i=o.find(n=>n.id===t);return(i==null?void 0:i[s])||i},deleteQuickReply:t=>a(s=>{const o=s.quickReplies.filter(i=>i.id!==t);return f("respostasRapidas",o),{quickReplies:o}}),sortQuickReply:t=>a(()=>(f("respostasRapidas",t),{quickReplies:t}))}));var za=Kt();const qe=Jt(za),he=A(a=>({contatos:[],setContatos:async e=>(await f("contatos",e),S.getState().plugin_page?N("setContatos",{contatos:e},!1):chrome.runtime.sendMessage({action:"setContatos",dados:{contatos:e}}),a(()=>({contatos:e})),{contatos:e})})),Da=async a=>{he.setState({contatos:a}),p.Utils("contatoInit",a),await f("contatos",a),chrome.runtime.sendMessage({action:"contatos-backup-update"})},xi=a=>{const e=[...he.getState().contatos];a.forEach(t=>{const s=e.findIndex(o=>o.id===t.id);s===-1?e.push(t):e[s]=t}),Da(e)},Oa=async()=>{const a=await B("contatos")||[];p.Utils("contatoInit",a),he.setState({contatos:a})},{setContatos:ja}=he.getState();chrome.runtime.onMessage.addListener(a=>{switch(a.action){case"setContatos":chrome.storage.local.get("contatos",e=>{JSON.stringify(e.contatos)!==JSON.stringify(he.getState().contatos)&&(ja(e.contatos),p.Utils("contatoInit",e.contatos))});break;case"contatos-backup-update":Oa();break}});const Ue=A()(a=>({chatName:{name:"",number:"",autoSave:!1},setAutoSaveChatName:e=>a(t=>(Q("autoSaveChat","autoSave",[e]),{chatName:{...t.chatName,autoSave:e}})),getActiveChat:async e=>{const{contatos:t,setContatos:s}=he.getState(),{chatName:o,setAutoSaveChatName:i}=Ue.getState(),r=await p.Utils("getContato",e),n=t.find(c=>c.id===e);if(a(n?{chatName:{...o,name:n.name,number:e}}:{chatName:{...o,name:r.name,number:e}}),o.autoSave&&await oe("contatos")===!0){i(!1);return}if(o.autoSave&&!n&&r.name!==r.number){const c={id:e,name:r.name};p.Utils("contatoSave",c);const d=[...t,c];s(d)}}}));T.subscribe(a=>{a.activeChat&&Ue.getState().getActiveChat(a.activeChat.id.user)});(async()=>{const a=await ce("autoSaveChat","autoSave");a&&a[0]&&a[0][0]&&Ue.getState().setAutoSaveChatName(a[0][0])})();const Wa="1.7",Va="true",Ba={model:"taghtml",parm:"body.color-refresh"},$a={model:"querySelector",selector:["#app"]},Ga={model:"querySelector",selector:["body > div"]},Ha={model:"Element",selector:"#pane-side"},Ja={model:"querySelector",selector:["#app > div > div > ._aigs"]},Ka={model:"Element",selector:"two"},Qa={model:"querySelector",selector:[".two._aigs > div:nth-child(5)"],disabledLog:!0},Xa={model:"Element",selector:"xsknx04"},Ya={model:"querySelector",selector:[".lexical-rich-text-input > div"]},Za={model:"querySelector",selector:["[data-icon='search']"],disabledLog:!0},es={model:"querySelector",selector:["header > div > div > div > div > span > div > div:nth-child(1)","header > div._ak0w"],disabledLog:!0},ts={model:"querySelector",selector:["header > header > div > span > div"],disabledLog:!0},as={model:"querySelector",selector:["#side > div._ak9t > div"],disabledLog:!0},ss={model:"querySelector",selector:["#main > header > div.xeuugli > div > div"],disabledLog:!0},os={model:"querySelector",selector:["#main ._amm9","#main .x1n2onr6.x1vjfegm.x1cqoux5.x14yy4lh"],disabledLog:!0},is={model:"querySelector",selector:["#main > header div.xmn8rco div"],disabledLog:!0},rs={model:"querySelector",selector:["footer ._ak1m"],disabledLog:!0},ns={model:"querySelector",selector:["footer > div"],disabledLog:!0},cs={model:"querySelector",selector:["footer div[contenteditable=true]"],disabledLog:!0},ds={model:"querySelector",selector:["footer > div.copyable-area > div"],disabledLog:!0},ls={model:"querySelector",selector:["#main > div.x1n2onr6.x1vjfegm.x1cqoux5.x14yy4lh"],disabledLog:!0},us={model:"querySelector",selector:["._1VZX7 ._3Uu1_, ._ak1r > div"],disabledLog:!0},ps={model:"querySelector",selector:["#main > footer > div > div > span > div > div._ak1r > div > div.x9f619.x78zum5.x6s0dn4","#main > footer > div.copyable-area > div > span > div > div._ak1r > div.x123j3cw"],disabledLog:!0},ms={model:"querySelector",selector:["#main > footer > div.copyable-area > div > span > div > div._ak1m > div > button[tabindex='-1']"],disabledLog:!0},fs={model:"querySelector",selector:["#main > footer > div:nth-child(3) > div > div:nth-child(4) > div > div > div > button","#main > footer > div:nth-child(3) > div > div > span > div > div > div.x9f619 > button"],disabledLog:!0},gs={model:"querySelector",selector:["#main > div.x1n2onr6.x1vjfegm.x1cqoux5.x14yy4lh > div > div.x10l6tqk.x13vifvy"],disabledLog:!0},hs={model:"querySelectorAll",selector:["div.x3psx0u.xwib8y2.xkhd6sd.xrmvbpv > div > div[data-id]"],disabledLog:!0},vs={model:"querySelector",selector:["#main > footer"],disabledLog:!0},As={model:"querySelector",selector:["#side > div.x1ky8ojb.x78zum5"],disabledLog:!0},bs={model:"querySelector",selector:["#side > div:nth-child(2)"]},Ss={model:"querySelector",selector:["#main > footer > div:nth-child(3) > div > div:nth-child(4) > div > div > div","#main > footer > div:nth-child(3) > div > div > span > div > div"],disabledLog:!0},ys={model:"querySelector",selector:["#pane-side > div > div > div"],disabledLog:!0},ws={model:"querySelectorAll",selector:["#pane-side > div > div > div div[tabindex='-1']"],disabledLog:!0},Cs={model:"Element",selector:"div._ak8l > div._ak8j > div._ak8i"},xs={model:"Element",selector:"x10l6tqk xh8yej3 x1g42fcv"},Ms={model:"Element",selector:"__reactFiber"},Ts={model:"querySelector",selector:["#side div._ai04 > button"],disabledLog:!0},ks={model:"listElement",list:{main_audio_1:"div._amk6._amlo",main_audio_2:"div._ak49._ak48",camp_text_1:"row-translate",camp_text_2:"span.selectable-text",add_btn_tradutor:"div.x1c4vz4f.x1q0g3np.x6s0dn4._amj_",camp_audio_1:'div[role="slider"] > canvas',camp_audio_2:'div[role="slider"] div._ahwf'}},_s={model:"querySelector",selector:["div.two._aigs > div._aigw"]},Rs={model:"querySelector",selector:["#main > span:nth-child(8)","#main > :last-child"],disabledLog:!0},Us={model:"querySelector",selector:["#main > span:nth-child(9)","#main > span:nth-child(8)"]},Fs={model:"querySelector",selector:["#app > div > span:nth-child(4)"]},Es={model:"querySelector",selector:["#app header > div > div > div > div > span > div > div.xyorhqc","#app > div > div.x78zum5.xdt5ytf.x5yr21d > div > header > div > div:nth-child(2) > div"]},Ls={model:"querySelector",selector:["#main header"]},Ns={model:"querySelector",selector:["#main > footer > div > div > span > div > div._ak1r > div"]},qs={version:Wa,disabeldOldMenu:Va,newModel:Ba,app:$a,afiliadoMain:Ga,paneSide:Ha,waPage:Ja,two:Ka,menuLateral:Qa,closeChat:Xa,chatListInput:Ya,searchInput:Za,downAba:es,chatListHeader:ts,searchCamp:as,chatName:ss,menuVertical:os,menuHorizontal:is,menuFooter:rs,respostaRapida:ns,footerTextArea:cs,mainAudio:ds,assChat:ls,assInput:us,assBtn:ps,assEmoji:ms,assCitacao:fs,listMensages:gs,allMensages:hs,assistenteChat:vs,trasferidos:As,notification:bs,quotedMsg:Ss,listChats:ys,listChatsUsers:ws,listChatAtendimento:Cs,insertAtendente:xs,reactFiber:Ms,updateChatList:Ts,useTradutor:ks,chatList:_s,observerFooter:Rs,observerFooterNewModel:Us,whatsModal:Fs,menu_whats:Es,actionMonitor:Ls,footerIconsLeft:Ns},V=A()((a,e)=>({domSelector:qs,getDomSelector:t=>{const{domSelector:s}=e();return s[t]},getSeletor:(t,s=o=>null)=>{const{getDomSelector:o}=e(),i=Wt[t],r=o(t);let n=null;if(!r)return null;for(let c of r.selector){let d=null;if(r.model==="querySelector"?d=document.querySelector(c):r.model==="querySelectorAll"&&(d=document.querySelectorAll(c)),d){n=d,s(d);break}}return!r.disabledLog&&!n&&(console.warn("Tag error: ",r.selector.toString()),console.warn(i.msg,i.error+`: [ *${r.selector.toString()}* ]`,t)),n},getElement:t=>{const{getDomSelector:s}=e();return s(t).selector},getListElement:(t,s)=>{const{getDomSelector:o}=e();return o(t).list[s]}}));chrome.runtime.onMessage.addListener(a=>{if(a.action==="Update_DomSelector"){const{domSelector:e}=V.getState();e.version!==a.dados.version&&window.location.reload()}});const R=A()(a=>({assinatura:{multiAtendimento:!1,active:!1,name:""},timeout:null,setAssinatura:(e,t)=>a(s=>{const o={...s.assinatura,[e]:t};return Q("useAssinatura","assinatura",[o]),s.dispartAssMultiAtendimento(),{assinatura:o}}),setMultiATendimento:()=>a(e=>{const{connect:t,disconnect:s}=J.getState(),{whatsappID:o,deviceID:i}=S.getState(),{language:r}=F.getState(),n={...e.assinatura};return e.assinatura.multiAtendimento?(n.multiAtendimento=!1,s()):n.name.length<2?O({type:"Error",message:r.insiraUmNomeCom3Caracteres,position:"top-right"}):(n.multiAtendimento=!0,t(o,i)),Q("useAssinatura","assinatura",[n]),{assinatura:n}}),sendTextChat:async()=>{var c,d;const{assinatura:e}=R.getState(),t=(d=(c=T.getState().activeChat)==null?void 0:c.id)==null?void 0:d.user,{getSeletor:s}=V.getState(),{language:o}=F.getState(),i=s("footerTextArea"),r=[...(i==null?void 0:i.childNodes)??[]].map(l=>l.innerText!==`
`?l.innerText:"").join(`
`);if(!i||!r.trim())return;let n;await oe("assinatura")===!0?(n=r,R.getState().setAssinatura("active",!1),O({type:"Info",message:o.assinaturaDesativada,position:"top-right"})):n=e.active?`*_${e.name}:_* 
${r}`:r,s("assEmoji",l=>{l==null||l.click()}),s("assCitacao",l=>{l==null||l.click()}),p.Functions("sendTextChat",{chatID:t,formattedMessage:n})},configAssinatura:()=>{const{getSeletor:e}=V.getState(),{activeChat:t}=T.getState();if(!t||!t.canSend)return;const s=d=>{d.key==="Enter"&&R.getState().assinatura.active&&(d.stopPropagation(),R.getState().sendTextChat())},o=qe(e("assChat"));o.off("keypress"),o.on("keypress",s);const i=d=>{d.key==="Enter"&&!d.shiftKey&&!d.altKey&&R.getState().assinatura.active&&(d.preventDefault(),d.stopPropagation(),R.getState().sendTextChat())};e("assInput",d=>{var u;const l=qe(d);l.off("keydown"),l[0]&&!l.data("keydownEventAdded")&&((u=l[0])==null||u.addEventListener("keydown",i,!0),l==null||l.data("keydownEventAdded",!0))});const r=d=>{R.getState().assinatura.active&&(d.preventDefault(),d.stopPropagation(),R.getState().sendTextChat())};e("assBtn",d=>{var u;const l=qe(d);l==null||l.off("click"),l[0]&&!l.data("ClickEventAdded")&&((u=l[0])==null||u.addEventListener("click",r,!0),l==null||l.data("ClickEventAdded",!0))});const n=e("mainAudio"),c=new MutationObserver(d=>{d[0].removedNodes.length!==0&&(o.off("keypress"),c.disconnect(),R.getState().configAssinatura())});n&&c.observe(n,{childList:!0})},insertName:()=>{var r,n;const{chatName:e}=Ue.getState(),t=(n=(r=T.getState().activeChat)==null?void 0:r.id)==null?void 0:n.user,{getSeletor:s}=V.getState(),o=s("footerTextArea"),i=[...(o==null?void 0:o.childNodes)??[]].map(c=>c.innerText!==`
`?c.innerText:"").join(`
`);p.Chat("setInputText",{txt:i.trim()?i+" "+e.name:e.name,id:t})},dispartAssMultiAtendimento:()=>{var s,o;const{timeout:e}=R.getState(),t=(o=(s=T.getState().activeChat)==null?void 0:s.id)==null?void 0:o._serialized;e&&clearTimeout(e),a({timeout:setTimeout(()=>{J.getState().update(t)},2500)})}}));T.subscribe(()=>{R.getState().configAssinatura()});const Mi=async()=>{const a=await ce("useAssinatura","assinatura");a&&a[0]&&a[0][0]&&R.setState({assinatura:a[0][0]})};function Is(a){return U({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 9v4"},child:[]},{tag:"path",attr:{d:"M10.363 3.591l-8.106 13.534a1.914 1.914 0 0 0 1.636 2.871h16.214a1.914 1.914 0 0 0 1.636 -2.87l-8.106 -13.536a1.914 1.914 0 0 0 -3.274 0z"},child:[]},{tag:"path",attr:{d:"M12 16h.01"},child:[]}]})(a)}function Ti(a){return U({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M18 9l3 3l-3 3"},child:[]},{tag:"path",attr:{d:"M15 12h6"},child:[]},{tag:"path",attr:{d:"M6 9l-3 3l3 3"},child:[]},{tag:"path",attr:{d:"M3 12h6"},child:[]},{tag:"path",attr:{d:"M9 18l3 3l3 -3"},child:[]},{tag:"path",attr:{d:"M12 15v6"},child:[]},{tag:"path",attr:{d:"M15 6l-3 -3l-3 3"},child:[]},{tag:"path",attr:{d:"M12 3v6"},child:[]}]})(a)}function ki(a){return U({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M16.5 10c3.038 0 5.5 2.015 5.5 4.5c0 1.397 -.778 2.645 -2 3.47l0 2.03l-1.964 -1.178a6.649 6.649 0 0 1 -1.536 .178c-3.038 0 -5.5 -2.015 -5.5 -4.5s2.462 -4.5 5.5 -4.5z"},child:[]},{tag:"path",attr:{d:"M11.197 15.698c-.69 .196 -1.43 .302 -2.197 .302a8.008 8.008 0 0 1 -2.612 -.432l-2.388 1.432v-2.801c-1.237 -1.082 -2 -2.564 -2 -4.199c0 -3.314 3.134 -6 7 -6c3.782 0 6.863 2.57 7 5.785l0 .233"},child:[]},{tag:"path",attr:{d:"M10 8h.01"},child:[]},{tag:"path",attr:{d:"M7 8h.01"},child:[]},{tag:"path",attr:{d:"M15 14h.01"},child:[]},{tag:"path",attr:{d:"M18 14h.01"},child:[]}]})(a)}function _i(a){return U({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14 4h6v6h-6z"},child:[]},{tag:"path",attr:{d:"M4 14h6v6h-6z"},child:[]},{tag:"path",attr:{d:"M17 17m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"},child:[]},{tag:"path",attr:{d:"M7 7m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"},child:[]}]})(a)}function Ri(a){return U({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z"},child:[]},{tag:"path",attr:{d:"M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"},child:[]}]})(a)}function Ui(a){return U({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0"},child:[]},{tag:"path",attr:{d:"M11.192 17.966c-3.242 -.28 -5.972 -2.269 -8.192 -5.966c2.4 -4 5.4 -6 9 -6c3.326 0 6.14 1.707 8.442 5.122"},child:[]},{tag:"path",attr:{d:"M18.42 15.61a2.1 2.1 0 0 1 2.97 2.97l-3.39 3.42h-3v-3l3.42 -3.39z"},child:[]}]})(a)}function Fi(a){return U({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 20l-3 1v-8.5l-4.48 -4.928a2 2 0 0 1 -.52 -1.345v-2.227h16v2.172a2 2 0 0 1 -.586 1.414l-4.414 4.414v1.5"},child:[]},{tag:"path",attr:{d:"M19.001 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"},child:[]},{tag:"path",attr:{d:"M19.001 15.5v1.5"},child:[]},{tag:"path",attr:{d:"M19.001 21v1.5"},child:[]},{tag:"path",attr:{d:"M22.032 17.25l-1.299 .75"},child:[]},{tag:"path",attr:{d:"M17.27 20l-1.3 .75"},child:[]},{tag:"path",attr:{d:"M15.97 17.25l1.3 .75"},child:[]},{tag:"path",attr:{d:"M20.733 20l1.3 .75"},child:[]}]})(a)}function Ei(a){return U({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M8 9h8"},child:[]},{tag:"path",attr:{d:"M8 13h6"},child:[]},{tag:"path",attr:{d:"M12 21l-3 -3h-3a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v5"},child:[]},{tag:"path",attr:{d:"M19 19m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"},child:[]},{tag:"path",attr:{d:"M17 21l4 -4"},child:[]}]})(a)}function Li(a){return U({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M8 9h8"},child:[]},{tag:"path",attr:{d:"M8 13h6"},child:[]},{tag:"path",attr:{d:"M12 21l-1 -1l-2 -2h-3a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v6"},child:[]},{tag:"path",attr:{d:"M20 21l2 -2l-2 -2"},child:[]},{tag:"path",attr:{d:"M17 17l-2 2l2 2"},child:[]}]})(a)}function Ni(a){return U({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M8 9h8"},child:[]},{tag:"path",attr:{d:"M8 13h6"},child:[]},{tag:"path",attr:{d:"M12 21l-3 -3h-3a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v6"},child:[]},{tag:"path",attr:{d:"M16 22l5 -5"},child:[]},{tag:"path",attr:{d:"M21 21.5v-4.5h-4.5"},child:[]}]})(a)}function qi(a){return U({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12.007 19.98a9.869 9.869 0 0 1 -4.307 -.98l-4.7 1l1.3 -3.9c-2.324 -3.437 -1.426 -7.872 2.1 -10.374c3.526 -2.501 8.59 -2.296 11.845 .48c1.992 1.7 2.93 4.04 2.747 6.34"},child:[]},{tag:"path",attr:{d:"M16 19h6"},child:[]},{tag:"path",attr:{d:"M19 16v6"},child:[]}]})(a)}function Ii(a){return U({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M8 9h8"},child:[]},{tag:"path",attr:{d:"M8 13h4.5"},child:[]},{tag:"path",attr:{d:"M10.325 19.605l-2.325 1.395v-3h-2a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v4.5"},child:[]},{tag:"path",attr:{d:"M17.8 20.817l-2.172 1.138a.392 .392 0 0 1 -.568 -.41l.415 -2.411l-1.757 -1.707a.389 .389 0 0 1 .217 -.665l2.428 -.352l1.086 -2.193a.392 .392 0 0 1 .702 0l1.086 2.193l2.428 .352a.39 .39 0 0 1 .217 .665l-1.757 1.707l.414 2.41a.39 .39 0 0 1 -.567 .411l-2.172 -1.138z"},child:[]}]})(a)}function Pi(a){return U({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M8 9h8"},child:[]},{tag:"path",attr:{d:"M8 13h6"},child:[]},{tag:"path",attr:{d:"M11.99 18.606l-3.99 2.394v-3h-2a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v5.5"},child:[]},{tag:"path",attr:{d:"M19 22v-6"},child:[]},{tag:"path",attr:{d:"M22 19l-3 -3l-3 3"},child:[]}]})(a)}function zi(a){return U({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M7 12l5 5l-1.5 1.5a3.536 3.536 0 1 1 -5 -5l1.5 -1.5z"},child:[]},{tag:"path",attr:{d:"M17 12l-5 -5l1.5 -1.5a3.536 3.536 0 1 1 5 5l-1.5 1.5z"},child:[]},{tag:"path",attr:{d:"M3 21l2.5 -2.5"},child:[]},{tag:"path",attr:{d:"M18.5 5.5l2.5 -2.5"},child:[]},{tag:"path",attr:{d:"M10 11l-2 2"},child:[]},{tag:"path",attr:{d:"M13 14l-2 2"},child:[]}]})(a)}function Di(a){return U({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2"},child:[]},{tag:"path",attr:{d:"M9 3m0 2a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v0a2 2 0 0 1 -2 2h-2a2 2 0 0 1 -2 -2z"},child:[]},{tag:"path",attr:{d:"M9 17v-5"},child:[]},{tag:"path",attr:{d:"M12 17v-1"},child:[]},{tag:"path",attr:{d:"M15 17v-3"},child:[]}]})(a)}function Oi(a){return U({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12.003 21c-.732 .001 -1.465 -.438 -1.678 -1.317a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c.886 .215 1.325 .957 1.318 1.694"},child:[]},{tag:"path",attr:{d:"M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0"},child:[]},{tag:"path",attr:{d:"M19.001 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"},child:[]},{tag:"path",attr:{d:"M19.001 15.5v1.5"},child:[]},{tag:"path",attr:{d:"M19.001 21v1.5"},child:[]},{tag:"path",attr:{d:"M22.032 17.25l-1.299 .75"},child:[]},{tag:"path",attr:{d:"M17.27 20l-1.3 .75"},child:[]},{tag:"path",attr:{d:"M15.97 17.25l1.3 .75"},child:[]},{tag:"path",attr:{d:"M20.733 20l1.3 .75"},child:[]}]})(a)}function ji(a){return U({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 10a3 3 0 1 0 6 0a3 3 0 0 0 -6 0"},child:[]},{tag:"path",attr:{d:"M6 21v-1a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v1"},child:[]},{tag:"path",attr:{d:"M3 5a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-14z"},child:[]}]})(a)}function Wi(a){return U({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M3 19c3.333 -2 5 -4 5 -6c0 -3 -1 -3 -2 -3s-2.032 1.085 -2 3c.034 2.048 1.658 2.877 2.5 4c1.5 2 2.5 2.5 3.5 1c.667 -1 1.167 -1.833 1.5 -2.5c1 2.333 2.333 3.5 4 3.5h2.5"},child:[]},{tag:"path",attr:{d:"M20 17v-12c0 -1.121 -.879 -2 -2 -2s-2 .879 -2 2v12l2 2l2 -2z"},child:[]},{tag:"path",attr:{d:"M16 7h4"},child:[]}]})(a)}const K=A()((a,e)=>({initSubscribeUserTabs:!1,FollowUp:[],createFollowUp:t=>a(s=>{const{acao:o}=Re.getState(),r=[{...t,acao:o},...s.FollowUp];return f("FollowUp",r),{FollowUp:r}}),editFollowUp:t=>a(s=>{const{acao:o}=Re.getState(),i={...t,acao:o},r=s.FollowUp.map(n=>n.id===i.id?i:n);return f("FollowUp",r),{FollowUp:r}}),deleteFollowUp:t=>{const s=F.getState().language;Vt({icon:g.jsx(Is,{className:"text-[var(--primaria)]",size:22}),content:g.jsxs(g.Fragment,{children:[s.removeFollowUp,g.jsxs("strong",{children:[" ",t.nome]}),"?"]}),confirmText:s.confirm,submit:()=>o()});const o=()=>{a(i=>{const r=i.FollowUp.filter(n=>n.id!==t.id);return f("FollowUp",r),{FollowUp:r}}),O({type:"Success",message:s.followUpRemovedSuccess,position:"top-right"})}},duplicateFollowUp:t=>a(s=>{const o=F.getState().language,i=s.getFollowById(t),r=i.nome.includes(`(${o.copy}`)?i.nome.split(` (${o.copy}`)[0]:i.nome,n=s.FollowUp.filter(l=>l.nome.startsWith(r+` (${o.copy}`)).length,d=[{...i,id:k(),nome:`${r} (${o.copy}${n>0?` ${n+1}`:""})`},...s.FollowUp];return f("FollowUp",d),{FollowUp:d}}),getFollowById:t=>e().FollowUp.find(s=>s.id===t),switchActive:t=>a(s=>{const o=F.getState().language,i=s.getFollowById(t);if(i.funil.abas.length===0&&i.funil.etiquetas.length===0)return O({type:"Error",message:o.followUpNotAllowedToActive,position:"top-right"}),s;const n=s.FollowUp.map(c=>c.id===t?{...c,active:!c.active}:c);return f("FollowUp",n),{FollowUp:n}}),disableFollowUp:t=>a(s=>{const o=s.FollowUp.map(i=>i.id===t?{...i,active:!1}:i);return f("FollowUp",o),{FollowUp:o}}),addChatToFollowUp:(t,s,o,i)=>a(r=>{try{const n=r.FollowUp.map(c=>{if(c.id===t){const d={...o,date:c.acionamento.type==="timing"?Date.now():null};if(i==="tab")return{...c,funil:{...c.funil,abas:c.funil.abas.map(l=>{if(l.id===s){const u=l.chats.filter(m=>m.id!==o.id);return{...l,chats:[...u,d]}}return l})}};if(i==="label")return{...c,funil:{...c.funil,etiquetas:c.funil.etiquetas.map(l=>{if(l.id===s){const u=l.chats.filter(m=>m.id!==o.id);return{...l,chats:[...u,d]}}return l})}}}return c});return f("FollowUp",n),{FollowUp:n}}catch(n){return console.error("❌ Erro ao adicionar chat ao follow-up:",n),r}}),removeChatFromFollowUp:(t,s,o,i)=>a(r=>{try{const n=r.FollowUp.map(c=>{if(c.id===t){if(i==="tab")return{...c,funil:{...c.funil,abas:c.funil.abas.map(d=>d.id===s?{...d,chats:d.chats.filter(l=>l.id!==o)}:d)}};if(i==="label")return{...c,funil:{...c.funil,etiquetas:c.funil.etiquetas.map(d=>d.id===s?{...d,chats:d.chats.filter(l=>l.id!==o)}:d)}}}return c});return f("FollowUp",n),{FollowUp:n}}catch(n){return console.error("Erro ao remover chat do follow-up:",n),r}}),removeTabFromFunnels:t=>a(s=>{const o=s.FollowUp.map(i=>{const r=i.funil.abas.filter(n=>!t.some(c=>c.id===n.id));return r.length!==i.funil.abas.length?{...i,funil:{...i.funil,abas:r}}:i});return f("FollowUp",o),{FollowUp:o}})})),Ps=a=>{K.setState({FollowUp:a}),f("FollowUp",a)},Vi=a=>{const e=K.getState().FollowUp,t=new Set(e.map(s=>s.id));a.forEach(s=>{t.has(s.id)||(e.push(s),t.add(s.id))}),Ps(e)},Bi=async()=>{try{const a=await B("FollowUp")||[];K.setState({FollowUp:a})}catch(a){console.error("Failed to initialize FollowUp:",a)}};function zs(a){var s,o,i;if(a.id.fromMe)return;const{FollowUp:e,removeChatFromFollowUp:t}=K.getState();for(let r of e)if((i=(o=(s=r==null?void 0:r.regras)==null?void 0:s.cancelAfterChat)==null?void 0:o.propriedades)!=null&&i.active){for(let n of r.funil.abas)t(r.id,n.id,a.id.remote,"tab");for(let n of r.funil.etiquetas)t(r.id,n.id,a.id.remote,"label")}}const Ds=A()((a,e)=>({monitors:[],addMonitor:t=>a(s=>({monitors:[...s.monitors,t]})),stopSendAction:t=>a(s=>({monitors:s.monitors.map(o=>o.id===t?{...o,sendAction:"Canceled"}:o)})),deleteMonitor:t=>a(s=>({monitors:s.monitors.filter(o=>o.id!==t)})),updateMonitor:(t,s,o)=>{let i=!0;return a(r=>({monitors:r.monitors.map(n=>n.id===t?(n.sendAction==="Canceled"&&(i=!1),{...n,actionIndice:s+1,activeAction:o}):n)})),i},getMonitor:t=>{const{monitors:s}=e();return s.filter(o=>o.userID===t)}}));async function we(a){if(!(a==null||a==0))return new Promise(e=>{setTimeout(()=>{e()},a*1e3)})}async function pe(a,e,t){e==null||e==0||(p.Chat(t==="txt"?"markIsComposing":"markIsRecording",{id:a,timer:e*1e3}),await we(e))}function Oe(a,e){const{assinatura:t}=R.getState();return e.desativar?a:e.personalizar?`*_${e.nome}:_*
${a}`:t.active?`*_${t.name}:_*
${a}`:a}const Os=async(a,e)=>{let t="";return(e.includes("#nome")||e.includes("#primeiroNome"))&&(t=(await p.Utils("getContato",a)).name),t},js=()=>{const{idioma:a}=F.getState(),e={pt:["Olá, tudo bem?","Olá, tudo bom?","Oi, tudo bem?","Oi, tudo bom?","E ai, tudo bem?","E ai, tudo bom?"],en:["Hello, how are you?","Hello, how's it going?","Hi, how are you?","Hi, how's it going?","Hey, how are you?","Hey, how's it going?"],es:["Hola, ¿cómo estás?","Hola, ¿qué tal?","Hola, ¿cómo estás?","Hola, ¿qué tal?","¿Qué onda, cómo estás?","¿Qué onda, qué tal?"]},t=Math.floor(Math.random()*e[a].length);return e[a][t]},Ws=()=>{const{idioma:a}=F.getState(),t=new Date().getHours(),s={pt:{manha:"Bom dia",tarde:"Boa tarde",noite:"Boa noite"},en:{manha:"Good morning",tarde:"Good afternoon",noite:"Good evening"},es:{manha:"Buenos días",tarde:"Buenas tardes",noite:"Buenas noches"}};return t>=6&&t<12?s[a].manha:t>=12&&t<18?s[a].tarde:s[a].noite};async function je(a,e){const t=await Os(a,e);try{e=e.replaceAll("#saudação",js),e=e.replaceAll("#periodo-dia",Ws),e=e.replaceAll("#primeiroNome",t.split(" ")[0]),e=e.replaceAll("#nome",t),e=e.replaceAll("#numero",a.replace("@g.us","").replace("@c.us",""))}catch(s){console.error("Erro ao validar existência de uma variável",s)}return e}const Vs=a=>{let e=0;if(a)for(let t of a)e+=parseFloat(t.valor);return e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})};function We(a,e){const{getPerfilContato:t}=P.getState();try{const s=t(a);if(!s)return e;e=e.replaceAll("#sexo",s.sexo),e=e.replaceAll("#data_nascimento",s.dataNascimento),e=e.replaceAll("#idioma",s.idioma),e=e.replaceAll("#email",s.email),e=e.replaceAll("#cidade",s.cidade),e=e.replaceAll("#estado",s.estado),e=e.replaceAll("#origem",s.origemLead),e=e.replaceAll("#data_entrada",s.entrada),e=e.replaceAll("#data_saida",s.saida),e=e.replaceAll("#valor_negocio",Vs(s.valNegocio||[])),e=e.replaceAll("#empresa",s.empresa),e=e.replaceAll("#cargo",s.cargo),e=e.replaceAll("#produtos_de_interesse",s.produtos.toString()),e=e.replaceAll("#observações",s.observacoes)}catch(s){console.error(`Erro ao tentar capturar o perfil do contato de ${a}`,s)}finally{return e}}async function Ve(a,e){if(e.includes("#mencionar-todos")&&a.includes("@g.us")){const s=(await p.Group("getParticipants",a)).map(i=>i.id),o=s.map(i=>" @"+i.replaceAll("@c.us",""));return e=e.replaceAll("#mencionar-todos",o.toString()),{mentionedList:s,msg:e}}else return e=e.replaceAll("#mencionar-todos",""),{mentionedList:[],msg:e}}async function Bs(a,e,t){await pe(a,e.composing,"txt");let{mentionedList:s,msg:o}=await Ve(a,e.mensagem);o=await je(a,o),o=We(a,o),o=Oe(o,t);const i=await p.Chat("sendTxt",{id:a,msg:o,mentionedList:s});return await we(e.aguarde),i}async function $s(a,e,t){await pe(a,e.composing,"txt");let{mentionedList:s,msg:o}=await Ve(a,e.mensagem);o=await je(a,o),o=We(a,o),o=Oe(o,t);const i=await p.Chat("sendImage",{id:a,msg:o,mentionedList:s,base64:e.base64,isViewOnce:e.isViewOnce});return await we(e.aguarde),i}async function Gs(a,e,t){await pe(a,e.composing,"txt");let{mentionedList:s,msg:o}=await Ve(a,e.mensagem);o=await je(a,o),o=We(a,o),o=Oe(o,t);const i=await p.Chat("sendVideo",{id:a,msg:o,mentionedList:s,base64:e.base64,microVideo:e.microVideo,isViewOnce:e.isViewOnce});return await we(e.aguarde),i}async function Hs(a,e){return await pe(a,e.composing,"audio"),await p.Chat("sendAudio",{id:a,base64:e.base64})}async function Js(a,e){return await p.Chat("sendDoc",{id:a,base64:e.base64,name:e.base64Name})}async function Ks(a,e){return await p.Chat("sendPixKeyMessage",{id:a,keyType:e.keyType,name:e.name,key:e.key})}async function Qs(a,e){return await p.Chat("sendGroupInviteMessage",{id:a,groupID:e.groupID})}async function Xs(a,e){return await p.Chat("sendContact",{id:a,phone:e.userID,name:e.userName})}async function Ys(a,e){return await p.Chat("linkPreview",{id:a,link:e.link,title:e.title,description:e.description})}async function Zs(a,e){return await p.Chat("sticker",{id:a,base64:e.base64})}async function eo(a,e,t){const{setNewUser:s}=q.getState();e==="abas"?s(a,t):Et(a,e,t,0)}async function At(a,e,t,s){const{setRemoveUser:o}=q.getState();(t==="abas"||e===!0)&&o(a,e,s),t!=="abas"&&Ut(a,e,t,s)}async function bt(a,e,t){const s=[{labelId:e,type:t}];await p.Labels("addOrRemoveLabels",{id:a,label:s})}async function to(a){const{labels:e}=await p.Chat("get",a);if(!e){console.error(`Etiquetas do contato ${a} não encotrada`);return}let t=[];for(const s of e)t.push({labelId:s,type:"remove"});await p.Labels("addOrRemoveLabels",{id:a,label:t})}async function St(a,e=!1){e?await p.Chat("desarquivar",a):await p.Chat("arquivar",a)}const D=A()(a=>({pin:[],pinChat:()=>{const e=T.getState().activeChat.id._serialized,s=D.getState().pin.find(o=>o.chatID===e);s?D.getState().setUnpinChat(s):D.getState().setPinChat(e)},pinOrUnpinChat:e=>{const s=D.getState().pin.find(o=>o.chatID===e);s?D.getState().setUnpinChat(s):D.getState().setPinChat(e)},setPinChat:e=>a(t=>{if(!w.getState().user.estado&&t.pin.length>0)return X.getState().openRendertype("user_free"),{};const s={chatID:e,pin:Date.now()},o=[s,...t.pin];return p.Functions("FixChats",{action:"pin",pin:s}),f("pinChat",o),{pin:o}}),setUnpinChat:e=>a(t=>{const s=t.pin.filter(o=>o.chatID!==e.chatID);return p.Functions("FixChats",{action:"unpin",pin:e}),f("pinChat",s),{pin:s}}),isPin:()=>{var s,o;const e=(o=(s=T.getState().activeChat)==null?void 0:s.id)==null?void 0:o._serialized;return e?!!D.getState().pin.find(i=>i.chatID===e):!1},usedPin:(e,t)=>{const o=D.getState().pin.find(i=>i.chatID===e);o&&D.getState().setUnpinChat(o),t==="pin"&&D.getState().setPinChat(e)}})),ao=async a=>{D.setState({pin:a}),p.Functions("FixChats",{action:"pinStorage",pin:a}),f("pinChat",a)},$i=a=>{const e=[...D.getState().pin],s=((o,i)=>o.concat(i).reduce((c,d)=>(c.find(u=>u.chatID===d.chatID)||c.push(d),c),[]))(e,a);ao(s)};async function Gi(){const a=await B("pinChat");p.Functions("FixChats",{action:"pinStorage",pin:a}),D.setState({pin:a})}async function yt(a,e){const{usedPin:t}=D.getState();t(a,e)}async function so(a){await p.Chat("markIsUnread",{id:a})}async function oo(a,e){const{socket:t,multi_atendente:s,atendente:o}=J.getState(),{whatsappID:i}=S.getState(),r=s.find(c=>c.email===e.email)||{id:"NaN",whatsappID:i,activeChat:"closeChat",userLogado:!0,email:e.email,assinaturaActive:!1,assinatura:e.email,deviceID:NaN},n={chatID:a,whatsappID:i,atendente:r,status:"Transferido",dataUltimaInteracao:Date.now()};t.emit("transferir_atendimento",{attID:r.id,remetenteID:o.id,chatID:a.replace(/@c\.us/g,""),text:e.mensagem,urgencia:e.urgencia},n)}async function io(a){await p.BlockList("blockContact",a)}async function ro(a,e,t){try{const{sendAction:s}=Dt.getState(),{getQuickReply:o}=Pa.getState(),i=o(e);await s(i,a,t)}catch(s){console.error("Error ao tentar enviar a resposta rapida pelo SendAction",s)}}async function Be(a,e,t,s){const{addMonitor:o,deleteMonitor:i,updateMonitor:r}=Ds.getState(),n=[],c=k();o({id:c,userID:a,sendAction:"Actived",remetente:s,actionsTam:e.length,actionIndice:0,activeAction:e[0]});for(const[d,l]of e.entries()){if(!r(c,d,l)){n.push(!1);break}switch(l.type){case"txt":n.push(await Bs(M(a),l.propriedades,t));break;case"image":n.push(await $s(M(a),l.propriedades,t));break;case"video":n.push(await Gs(M(a),l.propriedades,t));break;case"audio":n.push(await Hs(M(a),l.propriedades));break;case"doc":n.push(await Js(M(a),l.propriedades));break;case"pix":n.push(await Ks(M(a),l.propriedades));break;case"groupInvite":n.push(await Qs(M(a),l.propriedades));break;case"contact":n.push(await Xs(M(a),l.propriedades));break;case"linkPreview":n.push(await Ys(M(a),l.propriedades));break;case"sticker":n.push(await Zs(M(a),l.propriedades));break;case"addCRM":await eo(a,l.propriedades.crmID,l.propriedades.abaID);break;case"removeCRM":await At(a,!1,l.propriedades.crmID,l.propriedades.abaID);break;case"removeAllCRM":await At(a,!0);break;case"addLabel":await bt(M(a),l.propriedades.labelID,"add");break;case"removeLabel":await bt(M(a),l.propriedades.labelID,"remove");break;case"removeAllLabel":await to(M(a));break;case"timer":await we(l.propriedades.segundos);break;case"composing":await pe(a,l.propriedades.segundos,"txt");break;case"recording":await pe(a,l.propriedades.segundos,"audio");break;case"arquivar":await St(M(a));break;case"desarquivar":await St(M(a),!0);break;case"fixarChat":await yt(a,"pin");break;case"desfixarChat":await yt(a,"unpin");break;case"marcarNaoLido":await so(M(a));break;case"transferir":await oo(M(a),l.propriedades);break;case"bloquear":await io(M(a));break;case"respostaRapida":await ro(M(a),l.propriedades.respostaRapidaID,t);break;default:console.warn(`No handler found for action type: ${l.type}`);break}}return i(c),n.length===0||n.every(d=>d&&d.id)}async function $e(a,e){const{language:t}=F.getState(),{label:s}=be.getState();if(await oe("followUp",!0)===!0){Pe("followUp",t.btnPremium,s.checkout);return}const o=e.regras.assinatura.propriedades;await Be(a,e.acao,{desativar:o.active?o.desativarAss:!1,personalizar:o.active?o.persAss.active:!1,nome:o.persAss.nameAss},"useAcaoFollowUp"),z.getState().dispartWebhook(a.replace(/@c\.us/g,""),"followUp",{id:e.id,name:e.nome})}(function(){window.addEventListener("message",e=>{if(e.data.type==="Ev"&&e.data.action==="chat.update_label"){const t=JSON.parse(e.data.model),{type:s,chat:o,labels:i}=t,r={...o,id:M(o.id)},n=K.getState().FollowUp.filter(c=>c.active);if(n.length===0)return;if(s==="add"){co(r,i,n);const c=n.filter(d=>d.acionamento.type==="timing");i.forEach(d=>{lo(r,d.id,c)})}else if(s==="remove"){no(r,i,n);const c=n.filter(d=>d.acionamento.type==="timing");i.forEach(d=>{uo(r,d.id,c)})}}})})();function no(a,e,t){e.forEach(s=>{t.filter(i=>{var d,l,u;const r=i.funil.etiquetas.some(m=>m.id===s.id),n=a.id.endsWith("@g.us"),c=((u=(l=(d=i.regras)==null?void 0:d.responderGrupos)==null?void 0:l.propriedades)==null?void 0:u.active)!==!1;return r&&i.acionamento.type==="dispararAoSair"&&(!n||c)}).forEach(i=>{try{$e(a.id,i)}catch(r){console.error(`❌ Erro ao disparar follow-up: ${i.id} para o chat: ${a.id}`,r)}})})}function co(a,e,t){e.forEach(s=>{t.filter(i=>{var d,l,u;const r=i.funil.etiquetas.some(m=>m.id===s.id),n=a.id.endsWith("@g.us"),c=((u=(l=(d=i.regras)==null?void 0:d.responderGrupos)==null?void 0:l.propriedades)==null?void 0:u.active)!==!1;return r&&i.acionamento.type==="dispararAoEntrar"&&(!n||c)}).forEach(i=>{try{$e(a.id,i)}catch(r){console.error(`❌ Erro ao disparar follow-up: ${i.id} para o chat: ${a.id}`,r)}})})}function lo(a,e,t){t.filter(o=>{var c,d,l;const i=o.funil.etiquetas.some(u=>u.id===e),r=a.id.endsWith("@g.us"),n=((l=(d=(c=o.regras)==null?void 0:c.responderGrupos)==null?void 0:d.propriedades)==null?void 0:l.active)!==!1;return i&&(!r||n)}).forEach(o=>{K.getState().addChatToFollowUp(o.id,e,a,"label")})}function uo(a,e,t){t.filter(o=>{var c,d,l;const i=o.funil.etiquetas.some(u=>u.id===e),r=a.id.endsWith("@g.us"),n=((l=(d=(c=o.regras)==null?void 0:c.responderGrupos)==null?void 0:d.propriedades)==null?void 0:l.active)!==!1;return i&&(!r||n)}).forEach(o=>{K.getState().removeChatFromFollowUp(o.id,e,a.id,"label")})}function po(){const a=K.getState().FollowUp.filter(s=>s.active&&s.acionamento.type==="timing");if(a.length===0)return;const e=Date.now();let t=[];a.forEach(s=>{s.funil.abas.forEach(o=>{o.chats.forEach(i=>{if(!i.date)return;const r=te.convertTimingToMilliseconds(s.acionamento.timing);e>=i.date+r&&t.push({chat:i,abaId:o.id,followUp:s})})}),s.funil.etiquetas.forEach(o=>{o.chats.forEach(i=>{if(!i.date)return;const r=te.convertTimingToMilliseconds(s.acionamento.timing);e>=i.date+r&&t.push({chat:i,etiquetaId:o.id,followUp:s})})})}),t.forEach(({chat:s,abaId:o,etiquetaId:i,followUp:r})=>{$e(s.id,r),o?K.getState().removeChatFromFollowUp(r.id,o,s.id,"tab"):i&&K.getState().removeChatFromFollowUp(r.id,i,s.id,"label")})}chrome.runtime.onMessage.addListener(async a=>{switch(a.action){case"dispatch_timing_follow":po();break}});function mo(){q.subscribe((a,e)=>{if(!a.userTabs||!K.getState().initSubscribeUserTabs)return;const t=a.userTabs||[],o=(e.userTabs||[]).filter(i=>!t.some(r=>r.id===i.id));o.length!==0&&K.getState().removeTabFromFunnels(o)})}const fo=[{id:1,name:"tab_all",visibility:!0},{id:2,name:"tab_groups",visibility:!0},{id:3,name:"tab_unread",visibility:!0},{id:4,name:"tab_1_1",visibility:!0},{id:5,name:"tab_atendentes",visibility:!0}],q=A()(a=>({userTabs:[],systemTabs:fo,activeTab:{type:"tab",id:1},sortUserTabs:(e,t)=>a(s=>{const o=[...s.userTabs],[i]=o.splice(e,1),r=[...o.slice(0,t),i,...o.slice(t)];return f("userTabs",r),S.getState().plugin_page?N("userTabs-sortUserTabs",{home:e,destination:t}):chrome.runtime.sendMessage({action:"userTabs-sortUserTabs",dados:{home:e,destination:t}}),{userTabs:r}}),setNewUser:async(e,t)=>{var r;if(e=e.replace("@c.us","").replace("@g.us",""),(r=q.getState().userTabs.find(n=>n.id===t))==null?void 0:r.chats.find(n=>n.id===e))return;const{name:o}=await p.Utils("getContato",e),i=q.getState().userTabs.map(n=>{if(n.id===t){if(!w.getState().user.estado&&n.chats.length>=5)return window.postMessage({action:"modal-userFree",plugin_page:S.getState().plugin_page},"*"),n;{const c={...n,chats:[...n.chats,{id:e,name:o}]};return z.getState().dispartWebhook(e,"crm",{id:t,type:"NewUser",name:c.tag}),c}}else return n});f("userTabs",i),S.getState().plugin_page?N("userTabs-setNewUser",{userID:e,id:t}):chrome.runtime.sendMessage({action:"userTabs-setNewUser",dados:{userID:e,id:t}}),a(n=>({...n,userTabs:i}))},setChatsTab:async(e,t,s=!0)=>{const o=q.getState().userTabs.map(i=>i.id===t?{...i,chats:e}:i);q.setState({userTabs:o}),s&&(f("userTabs",o),S.getState().plugin_page?N("userTabs-setChatsTab",{chats:e,id:t}):chrome.runtime.sendMessage({action:"userTabs-setChatsTab",dados:{chats:e,id:t}}))},setCopyChats:(e,t)=>a(s=>{const o=s.userTabs.map(i=>{if(i.id===t){const r=e.filter(n=>!i.chats.some(c=>c.id===n.id));return{...i,chats:[...i.chats,...r]}}return i});return f("userTabs",o),S.getState().plugin_page?N("userTabs-setCopyChats",{chats:e,id:t}):chrome.runtime.sendMessage({action:"userTabs-setCopyChats",dados:{chats:e,id:t}}),{userTabs:o}}),setMoveChats:(e,t,s)=>a(o=>{const i=o.userTabs.map(r=>{if(r.id===t){const n=r.chats.filter(c=>!e.some(d=>d.id===c.id));return{...r,chats:n}}if(r.id===s){const n=[...r.chats,...e.filter(c=>!r.chats.some(d=>d.id===c.id))];return{...r,chats:n}}return r});return f("userTabs",i),S.getState().plugin_page?N("userTabs-setMoveChats",{chats:e,source:t,destination:s}):chrome.runtime.sendMessage({action:"userTabs-setMoveChats",dados:{chats:e,source:t,destination:s}}),{userTabs:i}}),setRemoveUser:(e,t,s)=>a(o=>{const i=e.replace("@c.us","").replace("@g.us",""),r=o.userTabs.map(n=>t?{...n,chats:n.chats.filter(c=>c.id!==i)}:n.id===s?{...n,chats:n.chats.filter(c=>c.id!==i)}:{...n});if(t)z.getState().dispartWebhook(i,"crm",{id:s,type:"RemoveUser-All"});else{const n=o.userTabs.find(c=>c.id===s);n&&z.getState().dispartWebhook(i,"crm",{id:s,type:"RemoveUser",name:n.tag})}return f("userTabs",r),S.getState().plugin_page?N("userTabs-setRemoveUser",{userID:i,isAll:t,id:s}):chrome.runtime.sendMessage({action:"userTabs-setRemoveUser",dados:{userID:i,isAll:t,id:s}}),{userTabs:r}}),setEditUserTabName:(e,t)=>a(s=>{const o=s.userTabs.map(i=>i.id===e?{...i,tag:t}:i);return f("userTabs",o),S.getState().plugin_page?N("userTabs-setEditUserTabName",{id:e,tabName:t}):chrome.runtime.sendMessage({action:"userTabs-setEditUserTabName",dados:{id:e,tabName:t}}),{userTabs:o}}),setRemoveTab:e=>a(t=>{const s=t.userTabs.filter(o=>o.id!==e);return f("userTabs",s),S.getState().plugin_page?N("userTabs-setRemoveTab",{id:e}):chrome.runtime.sendMessage({action:"userTabs-setRemoveTab",dados:{id:e}}),{userTabs:s}}),setCreateUserTab:e=>a(t=>{const s={id:k(),chats:[],tag:e,type:"user",hide:!1},o=[s,...t.userTabs];return f("userTabs",o),S.getState().plugin_page?N("userTabs-setCreateUserTab",{newUserTab:s}):chrome.runtime.sendMessage({action:"userTabs-setCreateUserTab",dados:{newUserTab:s}}),{userTabs:o}}),setVisibilityUserTab:e=>a(t=>{const s=t.userTabs.map(o=>o.id===e?{...o,hide:!o.hide}:o);return f("userTabs",s),S.getState().plugin_page?N("userTabs-setVisibilityUserTab",{id:e}):chrome.runtime.sendMessage({action:"userTabs-setVisibilityUserTab",dados:{id:e}}),{userTabs:s}}),getUserAbasTam:e=>q.getState().userTabs.filter(s=>s.chats.filter(o=>o.id===e).length>0).length,getTabByID:e=>q.getState().userTabs.find(s=>s.id===e),setVisibilitySystemTab:e=>a(t=>{const s=t.systemTabs.map(o=>o.id===e?{...o,visibility:!o.visibility}:o);return Q("SystemTabsDB","SystemTabs",[ue.encryptData(s)]),{systemTabs:s}}),setActiveTab:e=>a(t=>({...t,activeTab:e}))}));q.subscribe(()=>{Qe.getState().chatListTabs(),mo()});const Nt=A()((a,e)=>({active:"default",setActive:t=>a({active:t}),selecionados:[],getSelecionado:t=>!!e().selecionados.find(s=>s.id===t),onChangeSelecionado:(t,s,o)=>a(i=>i.selecionados.find(r=>r.id===t)?{selecionados:i.selecionados.filter(n=>{if(n.id!==t)return n})}:{selecionados:[...i.selecionados,{id:t,type:s,...o&&{chats:o}}]}),renderFiltroPersonalizado:()=>{q.getState().setActiveTab({id:"custom",type:"custom"}),p.ListChat("custom",e().selecionados)}}));Nt.subscribe(async a=>{q.getState().setActiveTab({id:"custom",type:"custom"}),p.ListChat("custom",{selecionados:a.selecionados,user:w.getState().user})});const qt=["chat","image","document","video","ptt","vcard","sticker","poll_creation","location"];function go(a){if(a.id.fromMe||!qt.includes(a.type))return;const{autoAtendimento:e}=ge.getState();e.forEach(t=>{t.active&&ho(a,t)})}const ho=async(a,e)=>{var u,m,v,h,b,G,E,ae,Ae,Ye,Ze,et,tt,at,st,ot,it,rt,nt,ct,dt,lt,ut,pt,mt;const{getUserAbasTam:t,userTabs:s}=q.getState(),o=y.getState().crm,{isBusiness:i}=S.getState(),r=a.id.remote.toString().replace(/@(.*)/,"");if(!e.regras.responderGrupos.propriedades.active&&a.author)return;const n=await p.Chat("getActiveChat","@");if(e.regras.responderChatAtivo.propriedades.active&&n===a.id.remote||((v=(m=(u=e==null?void 0:e.regras)==null?void 0:u.responderChatArquivado)==null?void 0:m.propriedades)==null?void 0:v.active)===!0&&(await p.Chat("get",r)).archive)return;const c=new Date().getDay(),d=["domingo","segunda","terca","quarta","quinta","sexta","sabado"];if("domingo"in e.regras.responderDias.propriedades&&e.regras.responderDias.propriedades.active){const Y=d[c],{horaInicio:H,horaFim:L,periodoAtivacao:I,active:Z}=e.regras.responderDias.propriedades[Y]||{};if(!H||!L||!Z||I&&!te.isValidInterval(H,L))return}const{labels:l}=await p.Chat("get",a.id.remote);if(!(i&&((G=(b=(h=e.regras)==null?void 0:h.notResponderChatEtiquetado)==null?void 0:b.propriedades)==null?void 0:G.active)===!0&&l.length>0)&&!(i&&((Ae=(ae=(E=e.regras)==null?void 0:E.notResponderEtiqueta)==null?void 0:ae.propriedades)==null?void 0:Ae.active)===!0&&e.regras.notResponderEtiqueta.propriedades.labelID.some(L=>l.includes(L)))&&!(i&&((et=(Ze=(Ye=e==null?void 0:e.regras)==null?void 0:Ye.responderEtiqueta)==null?void 0:Ze.propriedades)==null?void 0:et.active)===!0&&!e.regras.responderEtiqueta.propriedades.labelID.some(L=>l.includes(L)))&&!(((st=(at=(tt=e==null?void 0:e.regras)==null?void 0:tt.notResponderChatCRM)==null?void 0:at.propriedades)==null?void 0:st.active)===!0&&t(r)+Ft(r)!==0)){if(((rt=(it=(ot=e==null?void 0:e.regras)==null?void 0:ot.notResponderCRM)==null?void 0:it.propriedades)==null?void 0:rt.active)===!0){const Y=e.regras.notResponderCRM.propriedades.crm;let H=!0;for(const L of Y)if(L.crmID==="abas")(nt=s.find(I=>I.id===L.abaID))==null||nt.chats.forEach(I=>{I.id===r&&(H=!1)});else for(const I of o)I.id===L.crmID&&((ct=I.list.find(Z=>Z.id===L.abaID))==null||ct.chats.forEach(Z=>{Z.id===r&&(H=!1)}));if(!H)return}if(((ut=(lt=(dt=e==null?void 0:e.regras)==null?void 0:dt.responderCRM)==null?void 0:lt.propriedades)==null?void 0:ut.active)===!0){const Y=e.regras.responderCRM.propriedades.crm;let H=!1;for(const L of Y)if(L.crmID==="abas")(pt=s.find(I=>I.id===L.abaID))==null||pt.chats.forEach(I=>{I.id===r&&(H=!0)});else for(const I of o)I.id===L.crmID&&((mt=I.list.find(Z=>Z.id===L.abaID))==null||mt.chats.forEach(Z=>{Z.id===r&&(H=!0)}));if(!H)return}vo(a,e)}},vo=async(a,e)=>{const t=F.getState().language,{label:s}=be.getState(),{updateUsedLenght:o}=ge.getState(),i=async()=>{if(await oe("autoatendimento",!0)===!0){Pe("autoAtendimento",t.btnPremium,s.checkout);return}const r=e.regras.assinatura.propriedades;Be(a.id.remote.toString(),e.acao,{desativar:r.active?r.desativarAss:!1,personalizar:r.active?r.persAss.active:!1,nome:r.persAss.nameAss},"useAcaoAutoAtendimento"),o(e.id),z.getState().dispartWebhook(a.id.remote.toString().replace(/@c\.us/g,""),"autoAtendimento",{id:e.id,name:e.nome,usedLenght:e.usedLenght+1})};for(const r of e.acionamento){if(r.type==="message_Received"&&(r.text==a.body||r.text==a.caption)){i();break}if(r.type==="keyword"){let n=!1;if(r.chaves.forEach(c=>{a.type==="chat"&&a.body.includes(c)&&(n=!0)}),n){i();break}}if(r.type==="day_Message"){const n=a.id.remote.replace(/@(.*)/,""),c=(await p.Chat("getMessages",{id:n,quant:-1})).reverse();c.shift();const d=c.find(l=>l.id.fromMe===!1&&qt.includes(l.type));if(d){const l=parseInt(d.t.toString()+"000");if(!te.isDataDeHoje(l)){i();break}}}if(r.type==="customer_Message"){const n=a.id.remote.replace(/@(.*)/,"");if((await p.Chat("getMessages",{id:n})).filter(l=>l.type!=="e2e_notification"&&l.type!=="notification_template").length===1){i();break}}}},_=A((a,e)=>({workflows:[],currentWorkflow:null,saveToStorage:t=>{f("fluxo",t)},getSourceNode:(t,s)=>{const o=e().workflows.find(n=>n.id===s);if(!o)return null;const i=o.edges.find(n=>n.target===t);if(!i)return null;const r=o.nodes.find(n=>n.id===i.source);return r||null},getTargetNode:(t,s)=>{const o=e().workflows.find(n=>n.id===s);if(!o)return null;const i=o.edges.find(n=>n.source===t);if(!i)return null;const r=o.nodes.find(n=>n.id===i.target);return r||null},getTargetNodeByBestMatch:(t,s,o)=>{const i=e().workflows.find(l=>l.id===s);if(!i)return null;const r=i.nodes.find(l=>l.id===t);if(!r||r.type!=="send-answers")return null;const n=i.edges.filter(l=>l.source===t);if(!n.length)return null;const c=n.find(l=>{var m,v;return parseInt(((v=(m=l.sourceHandle)==null?void 0:m.split("-"))==null?void 0:v.pop())||"",10)===o});if(!c)return null;const d=i.nodes.find(l=>l.id===c.target);return d||null},getRetryQuestion:t=>{const{noMatch:s}=t;return s.sendPersonalizedMessage.active&&s.sendPersonalizedMessage.personalizedMessage||s.endPersonalizedMessage.active&&s.endPersonalizedMessage.personalizedMessage?s.sendPersonalizedMessage.active?s.sendPersonalizedMessage.personalizedMessage:s.endPersonalizedMessage.personalizedMessage:t.question},initNodeIsConnected:t=>{const s=t.nodes.find(i=>i.type==="init");return s?t.edges.some(i=>i.source===s.id):!1},getVariableByNodeId:(t,s)=>{const o=e().workflows.find(r=>r.id===s);if(!o)return;const i=o.variaveis.find(r=>r.nodeId===t);if(i)return i},updateVariableAsync:async(t,s,o,i)=>new Promise(r=>{a(n=>{const c=n.workflows.map(l=>{if(l.id!==o)return l;const u=l.variaveis.map(m=>{if(m.nodeId!==s)return m;const h=m.clients.some(b=>b.userId===t)?m.clients.map(b=>b.userId===t?{...b,value:i}:b):[...m.clients,{userId:t,value:i}];return{...m,clients:h}});return{...l,variaveis:u}}),d=n.currentWorkflow&&n.currentWorkflow.id===o&&c.find(l=>l.id===o)||n.currentWorkflow;return e().saveToStorage({workflows:c,currentWorkflow:d}),setTimeout(()=>r(),0),{workflows:c,currentWorkflow:d}})}),delay:t=>new Promise(s=>setTimeout(s,t))}));async function Hi(){const a=await B("fluxo")||{};_.setState({workflows:a.workflows||[],currentWorkflow:null})}function Ji(a){var d;const{workflows:e,currentWorkflow:t}=a,s=_.getState(),o=new Set(s.workflows.map(l=>l.name)),i=l=>{let u=l,m=1;for(;o.has(u);)u=`${l} (${m})`,m++;return u},r=e.map(l=>{s.workflows.find(h=>h.id===l.id)&&(l.id=k());const m=s.workflows.find(h=>h.id===l.id);if(m){const h={...m,...l};return h.name!==m.name&&(h.name=i(h.name)),h}const v=i(l.name);return{...l,name:v}}),n=t?((d=s.currentWorkflow)==null?void 0:d.id)===t.id?{...s.currentWorkflow,...t}:t:s.currentWorkflow,c={workflows:r,currentWorkflow:n};_.setState(c),_.getState().saveToStorage(c)}function Ki(a){const{workflows:e,currentWorkflow:t}=a,s={workflows:e||[],currentWorkflow:t||null};_.setState(s),_.getState().saveToStorage(s)}chrome.storage.onChanged.addListener((a,e)=>{var t;if((t=a.fluxo)!=null&&t.newValue){const s=a.fluxo.newValue;_.setState({workflows:s.workflows||[],currentWorkflow:s.currentWorkflow||null})}});const W=A((a,e)=>({progresses:{},resetUserProgress:t=>{a(s=>{const{[t]:o,...i}=s.progresses;return{progresses:i}})},updateUserProgress:(t,s,o)=>{a(i=>({progresses:{...i.progresses,[t]:{currentNodeId:o,workflowId:s}}}))},getUserProgress:t=>e().progresses[t]})),Ao=A((a,e)=>({processingUsers:new Set,addProcessingUser:t=>{const s=new Set(e().processingUsers);s.add(t),a({processingUsers:s})},removeProcessingUser:t=>{const s=new Set(e().processingUsers);s.delete(t),a({processingUsers:s})},isProcessing:t=>e().processingUsers.has(t)})),It=["chat","image","document","video","ptt","vcard","sticker","poll_creation","location"];async function bo(a,e){for(const t of e.acionamentos)switch(t.type){case"aoReceberMensagem":{if(t.data.active)return!0;break}case"porPalavraChave":{const s=t.data;if(a.type==="chat"&&s.chaves.some(o=>a.body.includes(o))&&s.active)return!0;break}case"primeiraMensagemDoClienteNoDia":{const s=a.id.remote.toString().replace(/@(.*)/,""),i=(await p.Chat("getMessages",{id:s,quant:-1})).reverse().slice(1).find(r=>r.id.fromMe===!1&&It.includes(r.type));if(i&&!te.isDataDeHoje(parseInt(i.t.toString()+"000"))&&t.data.active)return!0;break}case"primeiraMensagemDoCliente":{const s=a.id.remote.toString().replace(/@(.*)/,"");if((await p.Chat("getMessages",{id:s})).filter(i=>i.type!=="e2e_notification"&&i.type!=="notification_template").length===1&&t.data.active)return!0;break}default:return!1}return!1}async function So(a,e){const{getUserAbasTam:t,userTabs:s}=q.getState(),o=y.getState().crm,{isBusiness:i}=S.getState(),r=a.id.remote.toString().replace(/@(.*)/,""),{labels:n}=await p.Chat("get",a.id.remote.toString());for(const c of e.regras)switch(c.type){case"responderGrupos":{if(!c.propriedades.active&&a.author)return!1;break}case"responderChatAtivo":{const d=await p.Chat("getActiveChat","@");if(c.propriedades.active&&d===a.id.remote.toString())return!1;break}case"responderDias":{const d=new Date().getDay(),u=["domingo","segunda","terca","quarta","quinta","sexta","sabado"][d],{horaInicio:m,horaFim:v,periodoAtivacao:h,active:b}=c.propriedades[u]||{};if(b&&h&&!te.isValidInterval(m,v))return!1;break}case"notResponderChatEtiquetado":{if(i&&c.propriedades.active&&n.length>0)return!1;break}case"notResponderEtiqueta":{if(i&&c.propriedades.active){const{labelID:d}=c.propriedades;if(n.some(l=>d.includes(l)))return!1}break}case"responderEtiqueta":{if(i&&c.propriedades.active){const{labelID:d}=c.propriedades;if(!n.some(l=>d.includes(l)))return!1}break}case"notResponderChatCRM":{if(c.propriedades.active&&t(r)+Ft(r)!==0)return!1;break}case"notResponderCRM":{if(c.propriedades.active){const{crm:d}=c.propriedades;let l=!0;for(const u of d)if(u.crmID==="abas"){if(s.some(m=>m.id===u.abaID&&m.chats.some(v=>v.id===r))){l=!1;break}}else for(const m of o)if(m.id===u.crmID&&m.list.some(v=>v.id===u.abaID&&v.chats.some(h=>h.id===r))){l=!1;break}if(!l)return!1}break}case"responderCRM":{if(c.propriedades.active){const{crm:d}=c.propriedades;let l=!1;for(const u of d)if(u.crmID==="abas"){if(s.some(m=>m.id===u.abaID&&m.chats.some(v=>v.id===r))){l=!0;break}}else for(const m of o)if(m.id===u.crmID&&m.list.some(v=>v.id===u.abaID&&v.chats.some(h=>h.id===r))){l=!0;break}if(!l)return!1}break}}return!0}const Ge=A((a,e)=>({lastMessages:{},updatedVariables:{},setLastMessage:(t,s)=>{a(o=>({lastMessages:{...o.lastMessages,[t]:s}}))},getLastMessage:t=>e().lastMessages[t],clearLastMessage:t=>a(s=>{const o={...s.lastMessages};return delete o[t],{lastMessages:o}}),markVariableAsUpdated:(t,s)=>{const o=`${t}:${s}`;a(i=>({updatedVariables:{...i.updatedVariables,[o]:!0}}))},isVariableUpdated:(t,s)=>{const o=`${t}:${s}`;return e().updatedVariables[o]===!0},resetUpdatedVariables:t=>{a(s=>{const o={...s.updatedVariables};return Object.keys(o).forEach(i=>{i.startsWith(`${t}:`)&&delete o[i]}),{updatedVariables:o}})}})),yo=a=>{const e=a.nodes.find(s=>s.type==="init");return e?a.edges.some(s=>s.source===e.id):!1},wo=async(a,e)=>{let t="";return(e.includes("#nome")||e.includes("#primeiroNome"))&&(t=(await p.Utils("getContato",a)).name),t},Co=()=>{const a=["Olá, tudo bem?","Olá, tudo bom?","Oi, tudo bem?","Oi, tudo bom?","E ai, tudo bem?","E ai, tudo bom?"],e=Math.floor(Math.random()*a.length);return a[e]},xo=()=>{const e=new Date().getHours();return e>=6&&e<12?"Bom dia":e>=12&&e<18?"Boa tarde":"Boa noite"};async function Fe(a,e,t){var n;const{assinatura:s}=R.getState(),o=await wo(a,e);try{e=e.replaceAll("#saudação",Co()),e=e.replaceAll("#periodo-dia",xo()),e=e.replaceAll("#primeiroNome",o.split(" ")[0]),e=e.replaceAll("#nome",o),e=e.replaceAll("#numero",a.replace("@g.us","").replace("@c.us",""))}catch(c){console.error("Erro ao validar existência de uma variável",c)}const i=(n=t==null?void 0:t.regras)==null?void 0:n.find(c=>c.type==="assinatura"),r=i==null?void 0:i.propriedades;return r&&r.active&&r.persAss.active&&!r.desativarAss&&r.persAss.nameAss.length!==0&&e.length!==0?e=`*_${r.persAss.nameAss}:_*
${e}`:r&&r.active&&r.desativarAss&&e.length!==0||s.active&&s.name.length!==0&&e.length!==0&&(e=`*_${s.name}:_*
${e}`),e}const Ee=(a,e,t)=>e.replace(/{{(.*?)}}/g,(o,i)=>{const r=i.trim(),c=_.getState().workflows.find(l=>l.id===t.id).variaveis.find(l=>l.name.trim()===r);if(!c)return"";const d=c.clients.find(l=>l.userId===a);return(d==null?void 0:d.value)??""});async function Mo(a,e,t,s){var o;try{if(!(a!=null&&a.message))return;const i=(o=t==null?void 0:t.regras)==null?void 0:o.find(c=>c.type==="simulateWriting");((i==null?void 0:i.propriedades)??{active:!1}).active&&p.Chat("markIsComposing",{id:e,timer:2e4});let n=a.message;n=await Fe(e,n,t),n=Ee(e,n,t),await p.Chat("sendTxt",{id:e,msg:n})}catch(i){throw console.error(`Erro ao enviar mensagem para ${e}:`,i),i}}const ve=A(()=>({files:[]}));async function Qi(){const a=await B("fluxoFiles")||[];ve.setState({files:a})}chrome.storage.onChanged.addListener((a,e)=>{var t;if((t=a.fluxoFiles)!=null&&t.newValue){const s=a.fluxoFiles.newValue;ve.setState({files:s})}});async function To(a,e,t,s){var o;try{const i=ve.getState().files.find(d=>d.nodeRefId===s);if(!(i!=null&&i.base64))return;const r=(o=t==null?void 0:t.regras)==null?void 0:o.find(d=>d.type==="simulateWriting");((r==null?void 0:r.propriedades)??{active:!1}).active&&p.Chat("markIsComposing",{id:e,timer:2e4});let c=a.caption;c=await Fe(e,c,t),c=Ee(e,c,t),await p.Chat("sendImage",{id:e,base64:i.base64.toString(),msg:c})}catch(i){throw console.error(`Erro ao enviar imagem para ${e}:`,i),i}}async function ko(a,e,t,s){var o;try{const i=ve.getState().files.find(d=>d.nodeRefId===s);if(!(i!=null&&i.base64))return;const r=(o=t==null?void 0:t.regras)==null?void 0:o.find(d=>d.type==="simulateWriting");((r==null?void 0:r.propriedades)??{active:!1}).active&&p.Chat("markIsComposing",{id:e,timer:2e4});let c=a.caption;c=await Fe(e,c,t),c=Ee(e,c,t),await p.Chat("sendVideo",{id:e,base64:i.base64.toString(),msg:c})}catch(i){throw console.error(`Erro ao enviar video para ${e}:`,i),i}}async function _o(a,e,t,s){var o;try{const i=ve.getState().files.find(c=>c.nodeRefId===s);if(!(i!=null&&i.base64))return;const r=(o=t==null?void 0:t.regras)==null?void 0:o.find(c=>c.type==="simulateWriting");((r==null?void 0:r.propriedades)??{active:!1}).active&&p.Chat("markIsRecording",{id:e,timer:2e4}),await p.Chat("sendAudio",{id:e,base64:i.base64.toString()})}catch(i){throw console.error(`Erro ao enviar áudio para ${e}:`,i),i}}async function Ro(a,e,t,s){var o;try{const i=ve.getState().files.find(c=>c.nodeRefId===s);if(!(i!=null&&i.base64))return;const r=(o=t==null?void 0:t.regras)==null?void 0:o.find(c=>c.type==="simulateWriting");((r==null?void 0:r.propriedades)??{active:!1}).active&&p.Chat("markIsComposing",{id:e,timer:2e4}),await p.Chat("sendDoc",{id:e,base64:i.base64.toString(),name:i.name})}catch(i){throw console.error(`Erro ao enviar documento para ${e}:`,i),i}}async function Uo(a,e,t,s){var o;try{if(!(a!=null&&a.question))return;const i=(o=t==null?void 0:t.regras)==null?void 0:o.find(c=>c.type==="simulateWriting");((i==null?void 0:i.propriedades)??{active:!1}).active&&p.Chat("markIsComposing",{id:e,timer:2e4});let n=a.question;n=await Fe(e,n,t),n=Ee(e,n,t),await p.Chat("sendTxt",{id:e,msg:n})}catch(i){throw console.error(`Erro ao enviar mensagem para ${e}:`,i),i}}const Fo={"send-text":(a,e,t,s)=>Mo(a,e,t),"send-image":(a,e,t,s)=>To(a,e,t,s),"send-video":(a,e,t,s)=>ko(a,e,t,s),"send-audio":(a,e,t,s)=>_o(a,e,t,s),"send-document":(a,e,t,s)=>Ro(a,e,t,s),"send-answers":(a,e,t,s)=>Uo(a,e,t)};let wt=0;const Eo=1e4;async function ne(a,e,t){const{language:s}=F.getState(),{label:o}=be.getState(),{getSourceNode:i,updateVariableAsync:r}=_.getState(),{getLastMessage:n,isVariableUpdated:c,markVariableAsUpdated:d}=Ge.getState();if(a.type==="init")return;if(await oe("fluxo",!0)){const b=Date.now();b-wt>=Eo&&(wt=b,Pe("fluxo",s.btnPremium,o.checkout));return}const l=a.type,u=Fo[l];if(!u)throw new Error(`Tipo de nó não tratado: ${l}`);if(a.data.type!==l)throw new Error("Tipo de dados incompatível");const m=a.data,v=n(e),h=i(a.id,t.id);v&&h&&!c(e,h.id)&&(await r(e,h.id,t.id,v),d(e,h.id)),await u(m,e,t,a.id)}const He=a=>{const{unit:e,value:t}=a;switch(e){case"minutos":return t*60*1e3;case"segundos":return t*1e3;case"horas":return t*60*60*1e3;default:return 0}},Lo=.7,No=2,le=a=>a.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim(),qo=(a,e)=>{const t=Math.max(a.length,e.length);return t===0?1:(t-Tt(a,e))/t},Pt=(a,e)=>{const{options:t,typeDetection:s,allowNumberDetection:o}=e,i=le(a);let r=null;if(o){const c=parseInt(i,10);if(!isNaN(c)){const d=t.find(l=>l.index===c);if(d)return d}}if(s.active)switch(s.type){case"equals":return t.find(d=>le(d.text)===i)||null;case"contains":let c=0;if(t.forEach(d=>{const l=le(d.text);if(i.includes(l)){r=d;return}const u=qo(i,l);u>c&&u>=Lo&&(c=u,r=d)}),r)return r;break;case"startsWith":return t.find(d=>i.startsWith(le(d.text)))||null;case"endsWith":return t.find(d=>i.endsWith(le(d.text)))||null}let n=1/0;return t.forEach(c=>{const d=Tt(i,le(c.text));d<n&&d<=No&&(n=d,r=c)}),r},me=async(a,e,t)=>new Promise(s=>{const o=async i=>{if(i.data.type==="Ev"&&i.data.action==="chat.new_message"){const r=JSON.parse(i.data.model);r.id.remote.toString()===a&&!r.id.fromMe&&(Ge.getState().setLastMessage(a,r.body),window.removeEventListener("message",o),s(r.body))}};window.addEventListener("message",o)}),Je=async(a,e)=>new Promise(t=>{let s=!1,o,i;const r=n=>{s||(s=!0,i&&window.removeEventListener("message",i),clearTimeout(o),t(n))};o=setTimeout(()=>r("timeout"),e),i=n=>{if(n.data.type==="Ev"&&n.data.action==="chat.new_message"){const c=JSON.parse(n.data.model);c.id.remote.toString()===a&&!c.id.fromMe&&(clearTimeout(o),o=setTimeout(()=>r("timeout"),e))}},window.addEventListener("message",i)}),Io=async(a,e,t)=>{const s=_.getState().getTargetNode(a.id,t.id);return s&&W.getState().updateUserProgress(e,t.id,s.id),s},Ke=async(a,e,t)=>(await ne(a,e,t),W.getState().resetUserProgress(e),null),zt=async(a,e,t)=>{const s=a.data,{noMatch:o}=s,{sendPersonalizedMessage:i,endPersonalizedMessage:r,repeatBlock:n}=o||{};if(!(i!=null&&i.active)&&!(r!=null&&r.active)&&!n)return W.getState().resetUserProgress(e),null;const c=t.nodes.find(m=>m.send.type==="timeout"),d=c?He(c.send.data.waitTime):null,l=d?Je(e,d):null;if(r!=null&&r.active){const m={...a,data:{...s,question:r.personalizedMessage||""}};return await ne(m,e,t),W.getState().resetUserProgress(e),null}const u={...a,data:{...s,question:_.getState().getRetryQuestion(s)}};W.getState().updateUserProgress(e,t.id,u.id),await ne(u,e,t);try{const m=l?await Promise.race([me(e,a.id,t.id),l]):await me(e,a.id,t.id);if(m==="timeout")return c?await Ke(c,e,t):(W.getState().resetUserProgress(e),null);const v=Pt(m,s);if(v){const h=_.getState().getTargetNodeByBestMatch(a.id,t.id,v.index);if(h)return W.getState().updateUserProgress(e,t.id,h.id),await ne(h,e,t),h}return!v&&(n||i!=null&&i.active)?await zt(a,e,t):(W.getState().resetUserProgress(e),null)}catch{return W.getState().resetUserProgress(e),null}},Po=async(a,e,t)=>{let s=null;const o=t.nodes.find(n=>n.send.type==="timeout"),i=o?He(o.send.data.waitTime):null,r=i?Je(e,i):null;return r?s=await Promise.race([me(e,a.id,t.id),r]):s=await me(e,a.id,t.id),s==="timeout"?(o?await Ke(o,e,t):W.getState().resetUserProgress(e),null):(await ne(a,e,t),_.getState().getTargetNode(a.id,t.id))},zo=async(a,e,t)=>{let s=null;const o=_.getState().getSourceNode(a.id,t.id);if(!o||o.type!=="send-answers")return null;const i=o.send.data,r=t.nodes.find(u=>u.send.type==="timeout"),n=r?He(r.send.data.waitTime):null,c=n?Je(e,n):null;if(c?s=await Promise.race([me(e,a.id,t.id),c]):s=await me(e,a.id,t.id),s==="timeout")return r?await Ke(r,e,t):W.getState().resetUserProgress(e),null;const d=Pt(s,i);if(!d){const u=await zt(o,e,t);return u?_.getState().getTargetNode(u.id,t.id):null}const l=d?_.getState().getTargetNodeByBestMatch(o.id,t.id,d.index):null;if(l)return await ne(l,e,t),_.getState().getTargetNode(l.id,t.id)},Do=async(a,e,t)=>(await ne(a,e,t),_.getState().getTargetNode(a.id,t.id));async function Oo(a){if(a.id.fromMe||!It.includes(a.type))return;const e=a.id.remote.toString(),t=_.getState().workflows.filter(s=>s.active);if(t.length){for(const s of t){if(!yo(s)||!(await bo(a,s)&&await So(a,s)))continue;Ge.getState().resetUpdatedVariables(e);const i=W.getState(),r=Ao.getState(),n=s.nodes.find(d=>d.type==="init");if(!n)continue;let c=i.getUserProgress(e);if((!c||c.workflowId!==s.id)&&(i.resetUserProgress(e),i.updateUserProgress(e,s.id,n.id),c={currentNodeId:n.id,workflowId:s.id}),!r.isProcessing(e)){r.addProcessingUser(e);try{let d=s.nodes.find(l=>l.id===c.currentNodeId);if(!d){i.resetUserProgress(e);continue}for(;d;){switch(!0){case d.type==="init":d=await Io(d,e,s);break;case d.send.type==="timeout":i.resetUserProgress(e),d=null;break;case d.send.type==="on-response":d=await Po(d,e,s);break;case d.send.type==="next-block":d=await Do(d,e,s);break;case/^on-response-\d+$/.test(d.send.type):d=await zo(d,e,s);break;default:d=null}if(d)i.updateUserProgress(e,s.id,d.id);else{i.resetUserProgress(e);break}}i.resetUserProgress(e)}catch{i.resetUserProgress(e)}finally{r.removeProcessingUser(e)}}}W.getState().resetUserProgress(e)}}const Ct=z.getState().dispartWebhook;window.addEventListener("message",a=>{if(a.data.type==="Ev"&&a.data.action==="chat.new_message"){const e=JSON.parse(a.data.model);if(a.data.author&&(e.author=a.data.author),go(e),Oo(e),zs(e),Ct(e.from.replace(/@.*/g,""),"messages",e),e.ctwaContext){const t=e.from;Ct(t.replace(/@c\.us/g,""),"metaAds")}e.id.fromMe&&e.type==="chat"&&!e.author&&J.getState().filterAtendimento(e),q.getState().activeTab.type==="custom"&&setTimeout(()=>{Qe.getState().chatListTabs()},1e3)}});const Qe=A()(()=>({chatListTabs:async()=>{const{activeTab:a,userTabs:e}=q.getState(),{selecionados:t}=Nt.getState();if((a==null?void 0:a.type)==="tab")switch(a.id){case 1:await p.ListChat("tudo");break;case 2:await p.ListChat("grupos");break;case 3:await p.ListChat("nao-lido");break;case 4:await p.ListChat("1:1");break;case 5:await p.ListChat("atendimento",w.getState().user);break;case 6:await p.ListChat("trasferencias",w.getState().user);break;default:await p.ListChat("UserTabs",e.find(s=>s.id===a.id).chats);break}else a.type==="custom"?p.ListChat("custom",{selecionados:t,user:w.getState().user}):await p.ListChat("UserLabels",a.id)}}));async function jo(){const{user:a}=w.getState(),e=await B("initDate");return e?a.estado?!1:(Date.now()-e)/(24*60*60*1e3)>=3:(f("initDate",Date.now()),!1)}const J=A()((a,e)=>({active:!1,unsubscribeUserLogin:null,socket:null,atendente:null,multi_atendente:[],chatActive_atentendes:[],atendimentos:[],connect:async(t,s)=>{var h,b;const{update:o,ouvintes:i}=e(),{user:r}=w.getState(),{assinatura:n,setMultiATendimento:c}=R.getState(),d=(b=(h=T.getState().activeChat)==null?void 0:h.id)==null?void 0:b._serialized,{openRendertype:l}=X.getState();if(await jo()){l("user_free"),c();return}const m=Qt(ze.webSocket["multi-atendimento"],{path:"/ws/socket.io",transports:["websocket"]});m.open(),m.on("connection",null);const v={id:"",whatsappID:t,userLogado:r.estado,email:r.login,assinaturaActive:n.active,assinatura:n.name,activeChat:d,deviceID:s};m.emit("connect-atendente",v),p.MultiAtendimento("start"),o(d),i(m),a({socket:m,active:!0,unsubscribeUserLogin:w.subscribe(()=>{o(d)})})},disconnect:()=>a(()=>{const{socket:t,unsubscribeUserLogin:s}=e();return t==null||t.close(),t==null||t.disconnect(),p.MultiAtendimento("stop"),s&&s(),{active:!1,atendente:null,unsubscribeUserLogin:null}}),update:t=>{const{socket:s,atendente:o,active:i}=e(),{user:r}=w.getState(),{assinatura:n}=R.getState(),{whatsappID:c,deviceID:d}=S.getState();if(i&&o){const l={id:o.id,whatsappID:c,deviceID:d,userLogado:r.estado,activeChat:t,email:r.login,assinaturaActive:n.active,assinatura:n.name};s.emit("update-atendente",l),a({atendente:l})}},active_atendentes:t=>a(()=>{var i,r;const s=(r=(i=T.getState().activeChat)==null?void 0:i.id)==null?void 0:r._serialized,{whatsappID:o}=S.getState();return{multi_atendente:t,chatActive_atentendes:t.filter(n=>n.whatsappID===o&&n.activeChat===s)}}),send_atendimento:(t,s)=>{const{whatsappID:o}=S.getState(),{socket:i,atendente:r,active:n}=e(),c={chatID:t,whatsappID:o,atendente:r,status:s,dataUltimaInteracao:Date.now()};n&&r&&i.emit("update-atendimento",c)},trasferir_atendimento:(t,s,o)=>{var u;const{socket:i,atendente:r}=e(),{user:n,_serialized:c}=(u=T.getState().activeChat)==null?void 0:u.id,{whatsappID:d}=S.getState(),l={chatID:c,whatsappID:d,atendente:t,status:"Transferido",dataUltimaInteracao:Date.now()};i.emit("transferir_atendimento",{attID:t.id,remetenteID:r.id,chatID:n,text:s,urgencia:o},l)},getMyAtendimento:()=>{const{atendimentos:t}=J.getState(),{user:s}=w.getState(),{deviceID:o}=S.getState();return t.filter(i=>{var r,n;return s.estado?((r=i==null?void 0:i.atendente)==null?void 0:r.email)===s.login:((n=i==null?void 0:i.atendente)==null?void 0:n.deviceID)===o}).filter(i=>i.status!=="Finalizado").map(i=>i.chatID)},getAtendimentoByDeviceID:t=>{const{atendimentos:s}=e();return s.filter(o=>o.atendente.deviceID===t).filter(o=>o.status!=="Finalizado").length},filterAtendimento:t=>{const{send_atendimento:s}=e();t.body.includes("*_Atendimento Finalizado_*")||t.body.includes("*_Atendimento Trasferido para")||s(t.id.remote.toString(),"Ativo")},ouvintes:t=>{const{update:s}=e(),{renderTrasferencia:o}=de.getState();t.on("connected-atentende",({atendente:i,atendimentos:r})=>{var c,d;J.setState({atendente:i}),p.MultiAtendimento("setAtendimento",{atendimentos:r,user:w.getState().user}),J.setState({atendimentos:r});const n=(d=(c=T.getState().activeChat)==null?void 0:c.id)==null?void 0:d._serialized;s(n)}),t.on("active-atendentes",i=>{J.getState().active_atendentes(i)}),t.on("active-atendimento",i=>{p.MultiAtendimento("setAtendimento",{atendimentos:i,user:w.getState().user}),Qe.getState().chatListTabs(),J.setState({atendimentos:i})}),t.on("transferir_atendimento",i=>{o(i)})}})),Xi=async()=>{const{connect:a}=J.getState(),{assinatura:e}=R.getState();if(e.multiAtendimento){const{device:t,user:s}=await p.Conn("getMyDeviceId");a(s,t)}};T.subscribe(a=>{J.getState().update(a.activeChat.id._serialized)});const Wo=(a,e)=>{a.forEach(t=>{t.addedNodes.forEach(s=>{e(t)})})},Vo=a=>{const{update:e}=J.getState(),{getElement:t}=V.getState(),{setIsOpen:s}=fe.getState();Wo(a,o=>{var r;const i=o.addedNodes[0];(i==null?void 0:i.id)==="main"?s(!0):(r=i==null?void 0:i.classList)!=null&&r.contains(t("closeChat"))&&(e("closeChat"),s(!1))})},Bo=a=>{const{setIsThree:e}=fe.getState(),{getElement:t}=V.getState();a[0].target.classList.contains(t("two"))?e(!1):e(!0)},Ie=(a,e,t)=>{new MutationObserver(e).observe(a,t)},xt=()=>{const{getSeletor:a}=V.getState();a("menuLateral",e=>{Ie(e,Vo,{subtree:!0,childList:!0})}),a("waPage",e=>{Ie(e,Bo,{attributes:!0})})};Bt(V.getState().getElement("paneSide"),()=>{T.subscribe(()=>{xt()}),xt(),V.getState().getSeletor("whatsModal",a=>{Ie(a,e=>{const{setIsOpen:t}=fe.getState();e[0].addedNodes.length>0?t(!1):t(!0)},{childList:!0})})});const fe=A()((a,e)=>({isOpen:!1,setIsOpen:t=>a(s=>({isOpen:t})),isThree:!1,setIsThree:t=>a(s=>({isThree:t})),menuContent:{children:"close",width:"320",desactiveMonitorEnv:!1},setMenuContent:(t,s)=>a(o=>{const i={...o.menuContent,[t]:s};return Q("MenuContentDB","MenuContent",[i]),{menuContent:i}}),assinatura:{desativar:!1,personalizar:!1,nome:""},setAssinatura:(t,s)=>a(o=>{let i=o.assinatura;return t==="desativar"&&s?i={...o.assinatura,desativar:!0,personalizar:!1}:t==="personalizar"&&s?i={...o.assinatura,personalizar:!0,desativar:!1}:i={...o.assinatura,[t]:s},Q("menulatera-assinatura","assinatura",[i]),{assinatura:i}})}));(async()=>{const a=await ce("MenuContentDB","MenuContent");a&&a[0]&&a[0][0]&&fe.setState({menuContent:a[0][0]});const e=await ce("menulatera-assinatura","assinatura");e&&e[0]&&e[0][0]&&fe.setState({assinatura:e[0][0]})})();const Dt=A()((a,e)=>({actions:[],addActions:t=>a(s=>{const o=[...s.actions,t];return f("respostasRapidasAcao",o),{actions:o}}),editActions:t=>a(s=>{const o=s.actions.map(i=>i.id===t.id?t:i);return f("respostasRapidasAcao",o),{actions:o}}),deleteActions:t=>a(s=>{const o=s.actions.filter(i=>i.id!==t);return f("respostasRapidasAcao",o),{actions:o}}),edit:t=>{const{actions:s}=e(),o=s.find(i=>i.id===t);o&&Lt.setState({acao:o.acao})},getAction:t=>{const{actions:s}=e();return s.find(i=>i.id===t).acao||[]},sendAction:async(t,s,o)=>{var u;const{actions:i}=e(),{activeChat:r}=T.getState(),{assinatura:n}=fe.getState(),{language:c}=F.getState(),{dispartWebhook:d}=z.getState();let l=[];if(t.type==="script")for(const[m,{id:v,timer:h}]of t.script.entries()){const b=i.find(G=>G.id===v);b&&b.acao&&(m>0&&l.push({id:k(),propriedades:{segundos:h},type:"timer"}),l.push(...b.acao))}else l=(u=i.find(m=>m.id===t.id))==null?void 0:u.acao;if(l&&l.length>0){const m=s||r.id._serialized;await Be(m,l,o||n,"useAcaoRespostaRapida"),d(m.replace(/@(?:g|c)\.us/g,""),"respostaRapida",{id:t.id,type:t.type,name:t.titulo,categoria:t.categoria})}else O({type:"Error",message:c.createResNotAction,position:"top-right"})}}));chrome.runtime.onMessage.addListener(a=>{switch(a.action){case"sendAction-Res":Dt.getState().sendAction(a.dados.res,a.dados.userID);break}});const Ce=A((a,e)=>({relatorio:[],setRelatorio:async t=>{await f("relatorio",t),chrome.runtime.sendMessage({action:"setRelatorio",dados:{relatorio:t}}),a(()=>({relatorio:t}))},updateRelatorio:t=>{a(s=>{if(s.relatorio.find(i=>i.id===t.id)){const i=s.relatorio.map(r=>r.id===t.id?{...r,send:[...r.send,...t.send]}:r);return f("relatorio",i),{relatorio:i}}else{const i=[...s.relatorio];i.length>=30&&i.pop();const r=[t,...i];return f("relatorio",r),{relatorio:r}}})},getRelatorio:t=>{const{relatorio:s}=e(),o=s.find(i=>i.id===t);return o?o.send:[]}})),$o=async a=>{Ce.setState({relatorio:a}),await f("relatorio",a),chrome.runtime.sendMessage({action:"relatorio-backup-update"})},Yi=a=>{const e=[...Ce.getState().relatorio];a.forEach(t=>{const s=e.findIndex(o=>o.id===t.id);s===-1?e.push(t):e[s]=t}),$o(e)},Go=async()=>{const a=await B("relatorio")||[];Ce.setState({relatorio:a})},{setRelatorio:Ho}=Ce.getState();chrome.runtime.onMessage.addListener(a=>{switch(a.action){case"setRelatorio":chrome.storage.local.get("relatorio",e=>{JSON.stringify(e.relatorio)!==JSON.stringify(Ce.getState().relatorio)&&Ho(e.relatorio)});break;case"relatorio-backup-update":Go();break}});const C=A()(a=>({viewIA:"Gemini",setViewIA:e=>a({viewIA:e}),IA:{activeIA:null,keyGemini:"",keyGPT:"",instanceGemini:null,instanceGPT:null},setIA:(e,t)=>a(s=>{const o={...s.IA,[e]:t};return f("IA",o),{IA:o}}),validateGeminiKey:async(e=!0)=>{const{language:t}=F.getState(),s=C.getState().IA.keyGemini,o=`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${s}`;try{await Me.post(o,{contents:[{parts:[{text:"hello"}]}]});const r=new Gt(s).getGenerativeModel({model:"gemini-2.0-flash"});e&&O({type:"Success",message:t.useIAchaveAPI,position:"top-right"});const n={...C.getState().IA,activeIA:"Gemini",instanceGemini:r};C.setState({IA:n}),f("IA",n)}catch(i){C.setState({IA:{...C.getState().IA,activeIA:null,instanceGemini:null}}),i instanceof $t&&i.status===429?(console.error("Erro ao validar a chave Gemini:",i.status),O({type:"Error",message:t.useIAFreeTeste,position:"top-right"})):e&&O({type:"Error",message:t.useIAchaveAPI,position:"top-right"})}},validateGPTKey:(e=!0)=>{const{language:t}=F.getState(),s=()=>{const o={...C.getState().IA,activeIA:null,instanceGPT:null};C.setState({IA:o}),e&&O({type:"Error",message:t.ChaveDaApiGPTInvalida,position:"top-right"})};Me.get("https://api.openai.com/v1/engines",{headers:{Authorization:`Bearer ${C.getState().IA.keyGPT}`}}).then(()=>{try{const o=new Ht({apiKey:C.getState().IA.keyGPT||"",dangerouslyAllowBrowser:!0});e&&O({type:"Success",message:t.chaveGPTProntaParaUso,position:"top-right"});const i={...C.getState().IA,activeIA:"GPT",instanceGPT:o};C.setState({IA:i}),f("IA",i)}catch{s()}}).catch(o=>{s(),console.error("Erro ao realizar a ativação da key do gemini: "+o)})}})),Zi=async a=>{switch(C.setState({IA:a}),a.activeIA){case"Gemini":C.getState().validateGeminiKey(!1);break;case"GPT":C.getState().validateGPTKey(!1);break}},er=async()=>{const a=await B("IA")||[];switch(C.setState({IA:a}),a.activeIA){case"Gemini":C.getState().validateGeminiKey(!1);break;case"GPT":C.getState().validateGPTKey(!1);break}};async function Jo(a){const e=`Correct the spelling of this text while maintaining the default language: [${a}] , (take the received text calmly and correct its spelling, avoiding word substitutions as much as possible, keep all emojis, keep all characters, keep all links ) 
    After finishing, return the text between [ and ].`,t=await Xe(e);return{success:t.success,response:t.success?(()=>{const s=/\[([^\]]*?)\]/g;return t.response.match(s)[0].slice(1,-1)})():""}}async function Ko(a){const e=`improve this text by making it slightly more persuasive: [${a}] , (capture the text calmly and improve it, keep the language, keep all the emojis, keep all the characters, keep all the links, don't generate a link if it does not exist in the text) 
    After finishing, return the text between [ and ].`,t=await Xe(e);return{success:t.success,response:t.success?(()=>{const s=/\[([^\]]*?)\]/g;return t.response.match(s)[0].slice(1,-1)})():""}}const j=A()(a=>({assistente:{active:!1,model:"tradutor"},textAssistente:"",setAssistente:(e,t)=>a(s=>{const o={...s.assistente,[e]:t};Q("useAssistente","assistente",[o]),e==="active"&&!s.assistente.active&&j.getState().manipulatedInputText(),e==="model"&&setTimeout(()=>{j.getState().reloadText()},2500);const i=document.querySelector("main");return i&&i.setAttribute("active-assistente-chat",String(o.active)),{assistente:{...s.assistente,[e]:t}}}),formatTextAssistente:async e=>{const{assistente:t}=j.getState(),{activePerfil:s}=P.getState(),{IA:o}=C.getState();if(!o.activeIA||!e.trim()){a({textAssistente:""});return}switch(t.model){case"tradutor":const i=await Yo(s.idioma&&s.idioma.length!==0?s.idioma:"English",e);i.success&&a({textAssistente:i.response});break;case"corretor_ortografico":const r=await Jo(e);r.success&&a({textAssistente:r.response});break;case"otimizador_texto":const n=await Ko(e);n.success&&a({textAssistente:n.response});break}},manipulatedInputText:()=>{const{getSeletor:e}=V.getState(),{activeChat:t}=T.getState();if(!t||!t.canSend)return;const s=e("footerTextArea");if(!s)return;let o=null;const i=()=>{o&&clearTimeout(o),o=setTimeout(()=>{const n=[...(s==null?void 0:s.childNodes)??[]].map(c=>c.innerText!==`
`?c.innerText:"").join(`
`);j.getState().formatTextAssistente(n)},3e3)};new MutationObserver(i).observe(s,{subtree:!0,childList:!0,attributes:!0}),s.addEventListener("copy",i),s.addEventListener("paste",i),s.addEventListener("cut",i),e("assChat",n=>{const c=d=>{d.key==="Enter"&&d.altKey&&(d.stopPropagation(),j.getState().sendAssistenteMenssage())};n.addEventListener("keydown",c),setTimeout(()=>{n.scrollTop=n.scrollHeight},500)}),e("assInput",n=>{n==null||n.addEventListener("keydown",c=>{c.key==="Enter"&&c.altKey&&(c.preventDefault(),c.stopPropagation(),j.getState().sendAssistenteMenssage())},!0)})},reloadText:()=>{const{getSeletor:e}=V.getState(),t=e("footerTextArea"),s=[...(t==null?void 0:t.childNodes)??[]].map(o=>o.innerText!==`
`?o.innerText:"").join(`
`);j.getState().formatTextAssistente(s)},sendAssistenteMenssage:async()=>{var r,n;const{assinatura:e}=R.getState(),t=(n=(r=T.getState().activeChat)==null?void 0:r.id)==null?void 0:n.user,{textAssistente:s}=j.getState(),{getSeletor:o}=V.getState();if(s.length===0||await oe("assistente_chat"))return;let i=s;e.active&&(i=`*_${e.name}:_* 
${i}`),a({textAssistente:""}),p.Functions("sendTextChat",{chatID:t,formattedMessage:i}),o("assEmoji",c=>{c==null||c.click()}),o("assCitacao",c=>{c==null||c.click()})}}));T.subscribe(a=>{j.setState({textAssistente:""});const{assistente:e,manipulatedInputText:t}=j.getState();if(!e.active)return;const s=a.activeChat.draftMessage;s&&s.text&&s.text.length>0&&j.getState().formatTextAssistente(s.text),t()});(async()=>{const a=await ce("useAssistente","assistente");a&&a[0]&&a[0][0]&&j.setState({assistente:a[0][0]})})();const Qo=async a=>{const{instanceGemini:e}=C.getState().IA,s=(await e.generateContent(a)).response;return{success:!!(s&&s.text()),response:s.text()}},Xo=async a=>{const{instanceGPT:e}=C.getState().IA,{language:t}=F.getState();try{const s=await e.chat.completions.create({messages:[{role:"user",content:a}],model:"gpt-3.5-turbo-0125",temperature:.5});return{success:!!s.choices[0].message.content,response:s.choices[0].message.content}}catch(s){return s.code==="insufficient_quota"&&O({type:"Error",message:t.limiteDeUsoAtingidoOpenAI,position:"top-right"}),console.error(s),{success:!1,response:null}}};async function Xe(a){const{IA:e}=C.getState(),{openRendertype:t}=X.getState(),{setAssistente:s}=j.getState(),{language:o}=F.getState();let i;switch(e.activeIA){case"Gemini":i=await Qo(a);break;case"GPT":i=await Xo(a);break;default:t("Active_IA"),O({type:"Info",message:o.keyAPI_IA,position:"top-right"}),s("active",!1),i={success:!1,response:""};break}return i}async function Yo(a,e){const t=`Traduza o seguinte texto para ${a}, mantendo seu significado original:  

- Preserve todos os emojis, caracteres e links existentes.  
- Mantenha a formatação original do texto sempre que possível.  
- Não altere a estrutura das frases sem necessidade.  
- Mantenha a moeda do idioma original enfatizando que ela pertence a ele.
- Retorne o texto traduzido entre [ e ].  

Texto a ser traduzido: [${e}]`,s=await Xe(t);return{success:s.success,response:s.success?(()=>{const o=/\[([^\]]*?)\]/g;return s.response.match(o)[0].slice(1,-1)})():""}}const Zo={aba:"x1rg5ohu x173ssrc x1xaadd7 x682dto x1e01kqd x12j7j87 x9bpaai x1pg5gke x1s688f xo5v014 x1u28eo4 x2b8uid x16dsc37 x1sbl2l xy9co9w x5r174s x7h3shv ",confgIcone:"_ajv7 ",iconeStyle:"_ajv6 x1y1aw1k x1sxyh0 xwib8y2 xurb0ha ",modalOptions:{content1:"_ak4w _al02 ",content2:"_ak5b ",content3:"xyqdw3p xg8j3zb ",animFather:"_ajv9",animExe:"x11t6m9b",animChildren:"x11xpdln x1d8287x x1h4ghdb "},listagem:{content1:"x1i64zmx x1emribx ",content2:"_aj-r _aj-q _aj-_ _ak_v ",content3:"x1c4vz4f xs83m0k xdl72j9 x1g77sc7 x78zum5 xozqiw3 x1oa3qoh x12fk4p8 xeuugli x2lwn1j x1nhvcw1 x1q0g3np x6s0dn4 x1ypdohk x1vqgdyp x1i64zmx x1gja9t ",content4:"x1c4vz4f xs83m0k xdl72j9 x1g77sc7 x78zum5 xozqiw3 x1oa3qoh x12fk4p8 x2lwn1j xl56j7k x1q0g3np x1cy8zhl xt4ypqs xq8finb ",content5:"xdod15v xzwifym x6ikm8r x10wlt62 xlyipyv xuxw1ft "},footerIco:"_ajv6 x1y1aw1k x1sxyh0 xwib8y2 xurb0ha ",textarea:"_ak1l "},Ot=A()((a,e)=>({variaveisWA:Zo,isNewModel:!0,setIsNewModel:t=>{a({isNewModel:t});const s=document.querySelector("main");s&&s.setAttribute("isNewModel",String(e().isNewModel))}}));async function tr(){const{domSelector:a}=V.getState(),{setIsNewModel:e}=Ot.getState(),t=a.newModel;switch(t.model){case"taghtml":e(!!document.querySelector(t.parm));break;case"version":const s=await p.Conn("waVersion"),o=BigInt(s.replace(/\./g,"")),i=BigInt(t.parm.replace(/\./g,""));o>=i?e(!0):e(!1);break;case"all":e(!0);break}}const ei=A()(a=>({modalOptions:null,options:{},childrenRef:null,offset:0,auxFunc:{mounted:null,desmouted:null},open:(e,t,s,o=10,i={mounted:null,desmouted:null})=>a(r=>(i.mounted&&i.mounted(),r.childrenRef!==null&&r.auxFunc.desmouted&&r.auxFunc.desmouted(),{modalOptions:e,options:t,childrenRef:s,offset:o,auxFunc:i})),close:()=>a(e=>(e.auxFunc.desmouted&&e.auxFunc.desmouted(),{modalOptions:null,childrenRef:null,options:{}}))}));function ar(){const{modalOptions:a,options:e,childrenRef:t,offset:s,close:o}=ei(),{variaveisWA:i}=Ot(),{refs:r,floatingStyles:n,update:c,elements:d}=Xt({...e,middleware:[Zt({padding:5}),ea({padding:5}),ta({apply({availableWidth:l,availableHeight:u,elements:m}){Object.assign(m.floating.style,{maxWidth:`${l}px`,maxHeight:`${u}px`})}}),aa(s)]});return x.useEffect(()=>{if(a&&d.reference&&d.floating)return Yt(d.reference,d.floating,c)},[a,d,c]),x.useEffect(()=>{const l=u=>{var h;const m=document.querySelector(".iziToast-wrapper"),v=document.querySelector('section[data-id="Modal Emoji"]');r.floating.current&&!r.floating.current.contains(u.target)&&!t.contains(u.target)&&(!m||!m.contains(u.target))&&!((h=document.querySelector("#pane-side ._21S-L span"))!=null&&h.contains(u.target))&&!v&&o()};return t&&(r.setReference(t),document.addEventListener("click",l)),()=>{document.removeEventListener("click",l)}},[a,t]),a&&g.jsx("section",{"data-id":"Modal Options",children:g.jsx("div",{ref:r.setFloating,role:"tooltip",className:"z-[9999]",style:n,children:g.jsx("div",{className:i.modalOptions.content1+"!rounded-2xl animate__animated animate__zoomIn",style:{position:"initial",maxWidth:"100vw"},role:"application",children:g.jsx("ul",{"data-testid":"attach-menu-popup",className:i.modalOptions.content2,children:g.jsx("div",{className:i.modalOptions.content3,children:a})})})})})}export{Js as $,V as A,Ot as B,fe as C,da as D,j as E,ar as F,zi as G,R as H,tr as I,C as J,ga as K,J as L,Ai as M,Si as N,de as O,gt as P,Di as Q,Ds as R,$e as S,Wi as T,ji as U,Oi as V,Is as W,Pa as X,fo as Y,Yo as Z,oe as _,q as a,Bs as a0,Hs as a1,Gs as a2,$s as a3,Lt as a4,P as a5,Fi as a6,Ue as a7,D as a8,Ei as a9,re as aA,Re as aB,fi as aC,Na as aD,Ui as aE,yi as aF,Ti as aG,Nt as aH,Ni as aI,Pi as aJ,qi as aK,Li as aL,_i as aM,Ii as aa,na as ab,ki as ac,Ri as ad,he as ae,Ji as af,Ki as ag,Vi as ah,Ps as ai,vi as aj,$i as ak,ao as al,Zi as am,hi as an,wi as ao,Ia as ap,Yi as aq,$o as ar,mi as as,sa as at,xi as au,Da as av,qe as aw,ge as ax,ie as ay,_e as az,K as b,z as c,pi as d,Ci as e,Qi as f,Hi as g,Go as h,bi as i,gi as j,er as k,Bi as l,w as m,X as n,ei as o,Oa as p,Gi as q,ee as r,Mi as s,Xi as t,y as u,Be as v,Ce as w,qa as x,Dt as y,T as z};
